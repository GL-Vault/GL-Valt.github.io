## 一、概述
-----
### 1.1 概念

> 含义 

<span style="background:rgba(5, 117, 197, 0.2)">计算机网络</span>：是一个**将分散的，具有独立功能**的计算机系统，通过**通信设备和线路**连接起来，由功能完善的**软件**实现**资源共享和信息传递**的系统。

简单点说，计算机网络是**互联的，自治的**计算机集合。
<img src="https://i0.hdslb.com/bfs/album/e6b3beb429925cc92b63be1dd2a1bde25f5da065.png" alt="100" style="zoom:50%;" />

> 功能 

1. <span style="background:rgba(5, 117, 197, 0.2)"> 数据通信（连通性）</span>   
	数据通信是计算机网络最基本和最重要的功能，实现联网计算机之间的各种信息传输，并将分散在不同地理位置的计算机联系起来，进行统一的调配、控制和管理  
2.  <span style="background:rgba(5, 117, 197, 0.2)">资源共享  </span>  
	资源共享可以是**软件共享、数据共享和硬件共享**    
	计算机网络中的资源互通有无，分工协作，从而极大地提高硬件资源、软件资源和数据资源的利用率  
3.  <span style="background:rgba(5, 117, 197, 0.2)">分布式处理</span>  
	当计算机网络中的某个计算机系统负荷过重时，可以将其处理的某个复杂任务分配给网络中的其它计算机系统，让它帮你处理，从而利用空闲计算机资源以提高整个系统的利用率  
4.  <span style="background:rgba(5, 117, 197, 0.2)">提高可靠性</span>  
	计算机网络中的各台计算机可以通过网络互为替代机，当一台计算机崩了，可以让另一台计算机来完成它的工作  
5.  <span style="background:rgba(5, 117, 197, 0.2)">负载均衡</span>  
	将工作任务均衡的分配给计算机网络中的各台计算机   

> 组成  

*   <span style="background:rgba(5, 117, 197, 0.2)">组成部分</span>：一个完整的计算机网络主要由<span style="background:#fff88f">硬件、软件和协议</span>三大部分组成，缺一不可。  
	**硬件**主要由主机(也称端系统)，通信链路(如双绞线、光纤)、交换设备(如路由、交换机等)和通信处理机(如网卡)等组成。  
	
	**软件**主要包括各种实现资源共享的软件和方便用户使用的各种工具软件(如网络操作系统、邮件收发程序、FTP程序、聊天程序等)。  
	
	**协议**是计算机网络的核心，协议规定了网络传输数据时所遵循的规范。就如同我们现实生活中的法律一样，网络世界也必须遵循一定的规则。  

*   <span style="background:rgba(5, 117, 197, 0.2)">工作方式</span>：分为 `边缘部分和核心部分`。  
	 **边缘部分** 用户直接使用（C/S 方式——服务端客户端方式，P2P 方式——PeertoPeer，不太理解）  
	 
	 **核心部分** 为边缘部分服务   

<img src="https://i0.hdslb.com/bfs/album/2bd21d16a2fc341fd4a2262974482520194df5e6.png" style="zoom:50%;" />

*   <span style="background:rgba(5, 117, 197, 0.2)">功能组成</span>：由 <span style="background:#fff88f">通信子网和资源子网</span> 组成   
	 **通信子网** 实现数据通信   

	 **资源子网** 实现资源共享 / 数据处理  

<img src="https://i0.hdslb.com/bfs/album/0fe6ecfb961a1beb350567158b87eb8a8e10f326.png" style="zoom: 67%;" />

> 分类  

<img src="https://s2.loli.net/2022/12/31/EsNRKF7LgHMuocD.png" style="zoom:50%;" />

### 1.2 性能指标

> 速率  

速率即数据率或称数据传输率或比特率（bit）。即指<u>主机在数字信道上传送数据的速度</u>。

*   一般位简写为小写字母 “b”，字节简写为大写字母 “B”。
* 速率单位是b/s，kb/s，Mb/s，Gb/s，Tb/s。

**注意**  
![](https://i0.hdslb.com/bfs/album/22d766b19b0c3a541427c91e00063fb009ce26fb.png)

> 带宽

计算机网络中，<u>带宽用来表示网络的通信线路传送数据的能力</u>，指<span style="background:#fff88f">数字信道所能传送的 “最高数据率”</span>。单位是 “比特每秒”，b/s，kb/s，Mb/s，Gb/s。

以豌豆射手举例，假设 1b/s 是指每秒发出一个炮弹，那 2b/s 就是每秒发出两个炮弹，但是炮弹飞行的速度是不变的。

> 吞吐量

表示<u> 在单位时间内，通过某个网络（或信道、接口）的数据量</u>。单位 b/s，kb/s，Mb/s 等。  

<u>吞吐量受网络的带宽或网络的额定速率的限制，吞吐量是所有链路速率的加和。</u>  

**总结**：   
速率：表示实际的传输速率，其最高传输速率为带宽  
吞吐量：表示某个信道接口实际总的传输速率

> 时延 :star:

指数据（报文 / 分组 / 比特流）从网络（或链路）的<u>一端传送到另一端所需的时间</u>。也叫延迟或迟延。单位是 s。

![](https://i0.hdslb.com/bfs/album/e2a8f179fe56e399ded218edc3e4b202f332eee9.png)

<span style="background:#fff88f">总时延=以上四种时延总和</span>    

排队时延和处理时延类似于火车站排队进站时的场景，排队时间就是排队时延，安检时间就是处理时间。  

<span style="background:#d2cbff">例题</span>：
![](https://pic.imgdb.cn/item/63ce9979588a5d166c9271ea.png)

![](https://pic.imgdb.cn/item/63ce99ca588a5d166c933587.png)


> 时延带宽积

<span style="background:#fff88f">时延带宽积 = 传播时延 X 带宽</span>  
（传播时延 就是该信道上电磁波传播花费的时间）  

时延带宽积又称为以比特为单位的链路长度。即 “**某段链路现在有多少比特**”。

![](https://i0.hdslb.com/bfs/album/bf7323a6075800ba5b37e766347e97d1da3a9966.png)

> 往返时延 RTT

从发送方发送数据开始，到发送方收到接收方的确认（接收方收到数据后立即发送确认），总共经历的时延。

RTT = <u>往返传播时延（传播时延 * 2）</u>+ 末端处理时延（基本忽略不计）

> 利用率

![](https://i0.hdslb.com/bfs/album/7d93ac77bae8382878eff90dbb3559d8645bca91.png)

**总结**：  
时延：发送时延+传播时延+排队时延+处理时延  
时延带宽积：传播时延\*带宽  
往返时间RTT：传播时延\*2+(末端处理时延可忽略不计)  
利用率：分为<span style="background:#fff88f">信道利用率（重点）</span>和网络利用率  

### 1.3 分层结构

![](https://i0.hdslb.com/bfs/album/48221ca2b8dc57e0146cafd87cc1a9a2d3f457ae.png)
![](https://i0.hdslb.com/bfs/album/67bee0a3e66d30e8cb04c6d83100d1c75028a18b.png)

> 分层的基本原则

1.  各层之间相互独立，每层只实现一种相对独立的功能。
2.  每层之间界面自然清晰，易于理解，相互交流尽可能少。
3.  结构上可分割开。每层都采用最合适的技术来实现。
4.  保持下层对上层的独立性，上层单向使用下层提供的服务（下层为上层提供服务）。
5.  整个分层结构应该能促进标准化工作。

> 分层结构中的概念  

![](https://pic.imgdb.cn/item/63e338694757feff33dfea83.jpg)

1. 实体: 第 n 层中的活动元素称为 n 层实体。<span style="background:#fff88f">同一层的实体叫对等实体</span>。

2. 协议: 为进行网络中的<span style="background:#fff88f">对等实体</span>数据交换而建立的规则、标准或约定称为网络协议。【水平】（相对于对等实体）
	*   语法: 规定传输数据的格式
	*   语义: 规定所要完成的功能
	*   同步: 规定各种操作的顺序

3. 接口（访问服务点 SAP) : 上层使用下层服务的入口。

4. 服务: 下层为相邻上层提供的功能调用。【垂直】

<span style="background:#fff88f">上一层的 PDU 变成下一层的 SDU</span>。

![](https://i0.hdslb.com/bfs/album/21dbdf22f91995da5e63d2147087ea48e4a96f03.png)

![](https://pic.imgdb.cn/item/63cd63e6be43e0d30e708144.jpg)

![](https://pic.imgdb.cn/item/63cd63febe43e0d30e70a8ee.jpg)

**总结**：  
![](https://i0.hdslb.com/bfs/album/55e5d387ea46ef86f0cd8ca2ada30c890716ae12.png)


### 1.4 OSI 参考模型

![](https://i0.hdslb.com/bfs/album/31357d2e13db0ad3ae86d30888112090d8cebd05.png)
*   五层参考模型是为了方便学习而划分出来的，实际上并没有这个模型。  

*   使用 OSI 模型时的通信过程  
上面四层是相对于起点和终点之间，<u>端对端的协议</u>  
下面三层是各设备之间的通信，<u>点对点之间</u>(通常是一些路由器、交换机等)  

![](https://i0.hdslb.com/bfs/album/a562cbbafea414183855db8c9625ba0d9ba15d70.png)
![](https://i0.hdslb.com/bfs/album/e27d9e043c77372040e8e46d102d8bdce60715c0.png)  

> 接下来会介绍一下各个层的作用：  

<span style="background:rgba(5, 117, 197, 0.2)">1.  应用层 </span> 

所有<u>能和用户交互产生网络流量的程序</u>。如 QQ，浏览器等  
典型的应用层服务：  
*   文件传输（FTP）  
*   电子邮件（SMTP）  
*   万维网（HTTP）  

<span style="background:rgba(5, 117, 197, 0.2)">2.  表示层  </span>

用于处理在<u>两个通信系统</u>中交换信息的表示方式（语法和语义）  
功能：    
*   数据格式变换（翻译官）  
*   数据加密解密  
*   数据压缩和恢复  

<span style="background:rgba(5, 117, 197, 0.2)">3.  会话层</span>  

向表示层<u>实体 / 用户进程</u> ==提供建立连接== <span style="background:#fff88f">并在连接上有序地传输数据</span>。  
这是会话，也是建立同步 (SYN)。  
功能：   
*   建立、管理、终止会话
*   **使用校验点可使会话在通信失效时从校验点 / 同步点继续恢复通信，实现数据同步。适用于传输大文件。**

<span style="background:rgba(5, 117, 197, 0.2)">4.  传输层</span>  

负责主机中<u>两个进程</u>的通信，即<span style="background:#fff88f">端到端的通信</span>。传输单位是报文段或用户数据报。   
功能：  
*   可靠传输，不可靠传输（一般用于小文件）
*   差错控制（用来处理传输过程中出现的错误）
*   流量控制（当两台主机处理数据的速度不匹配时，会对速度过快的主机进行控制）
*   复用分用
    *   复用: 多个应用层进程可同时使用下面运输层的服务。
    *   分用: 运输层把收到的信息分别交付给上面应用层中相应的进程。

<span style="background:rgba(5, 117, 197, 0.2)">5.  网络层  </span>

主要任务是把**分组**从源端传到目的端，为分组交换网上的不同主机提供通信服务。  
<u>网络层传输单位是数据报。把数据报进行切割后，就是分组。</u>  
功能：  
*   路由选择（选择最合适的路由来传递数据）
*   流量控制
*   差错控制
*   拥塞控制（若所有结点都来不及接受分组，而要丢弃大量分组的话，网络就处于拥塞状态。因此要采取一定撒施，缓解这种拥塞。）

<span style="background:rgba(5, 117, 197, 0.2)">6.  数据链路层  </span>

主要任务是<span style="background:#fff88f">把网络层传下来的数据报组装成帧</span>。  
数据链路层 / 链路层的传输单位是帧。  
功能:  
*   成帧（定义帧的开始和结束）
*   差错控制 <font color="#e36c09">帧错+位错</font>
*   流量控制
*   访问（接入）控制（<font color="#e36c09">控制对信道的访问</font>）

<span style="background:rgba(5, 117, 197, 0.2)">7.  物理层  </span>

主要任务是<span style="background:#fff88f">在物理媒体上实现比特流的透明传输</span>。  
物理层<u>传输单位是比特</u>。  
透明传输: 指不管所传数据是什么样的比特组合, 都应当能够在链路上传送。  
功能：  
*   定义接口特性
*   定义传输模式
    *   单工 接受方和发送方已经确定，不能更改
    *   半双工 介于两者之间。同一时间段内，只能有一个接受方或发送方，但是身份可以调换。
    *   双工 可以同时当做接收方和发送方，类似于打电话
*   定义传输速率
*   比特同步
*   比特编码

### 1.5 TCP/IP 模型

![](https://i0.hdslb.com/bfs/album/3afb4d9356af56d1c3e0c9c280c6dab33226dda6.png)

![](https://pic.imgdb.cn/item/63cd5c81be43e0d30e60e24a.jpg)

### 1.6 OSI参考模型与TCP/IP参考模型

1. <span style="background:#d2cbff">相同点</span>  
	* 都分层  
	* 基于独立的协议栈的概念  
	* 可以实现异构网络互联  

2. <span style="background:#d2cbff">不同点</span>  
	* OSI定义三点：服务、协议、接口  
	* OSI先出现，参考模型先于协议发明，不偏向特定协议  
	* TCP/IP设计之初就考虑到异构网互联问题，将IP作为重要层次  
	* ![](https://i0.hdslb.com/bfs/album/5a996ef24fe91656fe551482ca287dd2f317a0ad.png)  
	  面向连接分为三个阶段，第一是建立连接，在此阶段，发出一个建立连接的请求。只有在连接成功建立之后，才能开始数据传输，这是第二阶段。接着，当数据传输完毕，必须释放连接。而面向无连接没有这么多阶段，它直接进行数据传输。

### 1.7 5层参考模型

![](https://i0.hdslb.com/bfs/album/82fb5a89ba9e16b8c617dba5980f52d04f05039c.png)

![](https://pic.imgdb.cn/item/63cd5f8cbe43e0d30e676989.jpg)

![](https://pic.imgdb.cn/item/63ce462f588a5d166ceb227d.jpg)

==重点==：<u>计算机网络的体系结构就是计算机网络及其构件所应完成的功能的精确定义</u>。  

<span style="background:#fff88f">需要强调的是</span>：<u>这些功能的实现细节（例如采用何种硬件或软件），则是遵守这种体系结构的具体实现问题，并不属于体系结构本身所描述的内容 </u>。  

<span style="background:#fff88f">5层参考模型的数据封装与解封装：</span>   

![](https://i0.hdslb.com/bfs/album/cea681ed52a7b54cb9186efc1f1d79526beb3d23.png)


## 二、 物理层
------

### 2.1 物理层概念

物理层，解决如何在连接各种计算机的传输媒体上<span style="background:#fff88f">传输数据比特流</span>，而不是指具体的传输媒体。

物理层主要任务 : <span style="background:#fff88f">确定与传输媒体接口有关的一些特性（即定义标准）</span>

> 物理层的几个特性

*   <span style="background:#fff88f">机械特性</span>：定义物理连接的特性，规定物理连接时所采用的**规格、接口形状、引线数目、引脚数量**和排列情况。  
*   <span style="background:#fff88f">电气特性</span>：规定传输二进制位时，线路上信号的**电压范围、阻抗匹配、传输速率和距离限制等**。  
*   <span style="background:#fff88f">功能特性</span>：指明某条线上出现的某一**电平表示何种意义**，接口部件的信号线的用途。（描述高低电平的含义）  
*   <span style="background:#fff88f">规程特性 (过程特性）</span>：定义各条物理线路的**工作规程和时序关系**。  

### 2.2 数据通信基础知识

> 数据通信模型

*   调制解调器就是路由器

![](https://i0.hdslb.com/bfs/album/1c0c9aab88d2e476e14cd705d25e3002514f5c53.png)

> 相关术语

*   <span style="background:#fff88f">通信</span>的目的是<u>传送消息</u>（消息: 语音、文字、图像、视频等）。
*   <span style="background:#fff88f">数据 data</span>: <u>传送信息的实体</u>，通常是有意义的符号序列。
*   <span style="background:#fff88f">信号</span>: 数据的电气 / 电磁的表现，是**数据在传输过程中的存在形式**。  
	分为**数字信号** 和**模拟信号**  
	![](https://i0.hdslb.com/bfs/album/88f05431fe9fb35499bc51dc886d53aa6e071d6a.png)

*   <span style="background:#fff88f">信源</span>: 产生和发送数据的源头。
*   <span style="background:#fff88f">信宿</span>: 接收数据的终点。
*   <span style="background:#fff88f">信道</span>: <u>信号的传输媒介</u>。一般用来表示向某一个方向传送信息的介质，因此一条通信线路往往包含一条发送信道和一条接收信道。
	![](https://i0.hdslb.com/bfs/album/9c2519536d62a697e22a77970b804876d1b25f88.png)

> 数据传输方式

*  <span style="background:rgba(5, 117, 197, 0.2)">单工通信</span>：<u>只有一个方向的通信</u>而<u>没有反方向的交互</u>，已确定发送方和接收方，**仅需要一条信道**。（广播）  
	<span style="background:rgba(5, 117, 197, 0.2)">半双工通信</span>：通信的双方都可以发送或接收信息，但<u>任何一方都不能同时发送和接收</u>，**需要两条信道**。（对讲机）  
	<span style="background:rgba(5, 117, 197, 0.2)">全双工通信</span>：<u>通信双方可以同时发送和接受信息</u>，**也需要两条信道**。（打电话）


* <span style="background:rgba(5, 117, 197, 0.2)">串行传输</span>：将表示一个字符的 8 位二进制数按由低位到高位的顺序依次发送。  
	特点：速度慢，费用低，适合远距离
	![](https://i0.hdslb.com/bfs/album/0e5b13face18f01b715cf13352e88ceb1c833719.png)

	<span style="background:rgba(5, 117, 197, 0.2)">并行传输</span>：将表示一个字符的 8 位二进制数同时通过 8 条信道发送。  
	特点：速度快，费用高，适合近距离。
	![](https://i0.hdslb.com/bfs/album/4b13abd29a53d15d73c7715dc328eed7baaf89e3.png)

### 2.3 码元，速率，波特

> 码元

码元是指用一个固定时长的**信号波形**（数字脉冲)，代表不同离散数值的基本波形，是数字通信中数字信号的计量单位，这个时长内的信号称为 M 进制码元，而该时长称为码元宽度。  

<span style="background:#fff88f">M进制码元，有M个离散状态，1个码元可以携带</span>$log_2^M$<span style="background:#fff88f">个比特信息</span>。  

<span style="background:#d2cbff">例如</span>：在使用<u>二进制编码</u>时，只有两种不同的码元，一种代表 0 状态，另一种代表 1 状态。<u>有2个离散状态，1个码元可以携带2个比特信息</u>。  

![](https://i0.hdslb.com/bfs/album/245bc0c0ea81eced04262ed658c36f0b4dbe73ec.png)

:star: <span style="background:#d2cbff">例如</span>：4 进制码元—> 码元的离散状态有 4 个—>4 种高低不同的信号波形 00、01、10、11(四种不同的电平)，这时1个码元携带2个比特的信息量。  

> 速率

速率也叫数据率，是指<span style="background:#fff88f">数据的传输速率</span>（发送速率），表示单位时间内传输的数据量。可以用<u>码元传输速率和信息传输速率</u>表示。

*   <span style="background:rgba(5, 117, 197, 0.2)">码元传输速率</span>: 别名码元速率、波形速率、调制速率、符号速率等，表示<span style="background:#fff88f">单位时间内所传输的码元个数</span>（也可称为<u>脉冲个数或信号变化的次数</u>)，单位是**波特（Baud)**。  
	**1 波特表示1秒传输1个码元。** 这里的码元可以是各种进制，<span style="background:#fff88f">码元速率与进制数无关</span>。

*   <span style="background:rgba(5, 117, 197, 0.2)">信息传输速率</span>: 别名信息速率、比特率等，<span style="background:#fff88f">表示单位时间内传输的比特数</span>，单位是比特 / 秒 (b/s)

*   <span style="background:#d2cbff">关系</span>: <u>若一个码元携带 n bit 的信息量，则 M Baud 的码元传输速率所对应的信息传输速率为 M×n bit/s</u>。

<span style="background:#d2cbff">例题</span>：  
![](https://pic.imgdb.cn/item/63d0a330588a5d166cea46ac.png)

### 2.4 奈氏准则，香农定理

> 失真

影响失真程度的因素:   
1. 码元传输速率  
2. 信号传输距离  
3. 噪声干扰  
4. 传输媒体质量  

![](https://i0.hdslb.com/bfs/album/c6d2d660e7b6e8e1e639c029a58c4d5d9d5cf49e.png)

> 码间串扰

码间串扰: 接收端收到的信号波形<u>失去了码元之间清晰界限</u>的现象。

![](https://i0.hdslb.com/bfs/album/7e017c9d3e871d2b10e3580b9ef09f31a5d3c5f3.png)

> 奈氏准则

奈氏准则: 在理想低通（无噪声，带宽受限) 条件下，为了避免码间串扰，<span style="background:#fff88f">极限码元传输速率</span>为 2W Baud（波特），W 是信道带宽单位是 Hz。

==注意==：只有在这两个公式带宽才用 Hz! !（<u>异曲同工：Hz表示1秒多少脉冲，也就是1秒的码元个数</u>）  

![](https://i0.hdslb.com/bfs/album/babf0e62bc4d5a7a31caef4e3e89e96ef74acc0b.png)
$log_2^V$：表示1码元携带的比特数。计算方法与上面的<span style="background:#fff88f">码元传输速率</span>和<span style="background:#fff88f">信息传输速率</span>相同。  

1.  在任何信道中，**码元传输的速率是有上限的**。若传输速率超过此上限，就会出现严重的码间串扰问题，使接收端对码元的完全正确识别成为不可能。

2.  信道的**频带越宽**（即能通过的信号高频分量越多，也就是说<u>最高频与最低频的宽度越大</u>)，就可以用更高的速率进行码元的有效传输。

3.  :star:奈氏准则给出了**码元传输速率的限制**，但**并没有对信息传输速率给出限制**。

4.  由于码元的传输速率受奈氏准则的制约，所以<u>要提高数据的传输速率，就必须设法使每个码元能携带更多个比特的信息量</u>，这就需要<span style="background:#fff88f">采用多元制的调制方法</span>。

> 香农定理

**噪声**存在于所有的电子设备和通信信道中。  
若噪声的瞬时值很大，因此噪声会使接收端对码元的判决产生错误。  
但是噪声是相对的，若信号较强，那么噪声影响相对较小。  
因此，<span style="background:#fff88f">信噪比</span>就很重要 。  
$$信噪比 = \frac{信号的平均功率}{噪声的平均功率} 常记为 \frac{S}{N}，并用分贝 (dB）作为度量单位$$
即：  
![](https://i0.hdslb.com/bfs/album/43b86c58a2f933e3ee19de22d52eadbc2ce916c6.png)  
:star:==注意==：题中出现<span style="background:#ff4d4f">信噪比有单位 dB</span> ，将其用上面公式<span style="background:#ff4d4f">算出</span>$\frac{S}{N}$<span style="background:#ff4d4f">值</span>，再代入下面的公式。

香农定理：在带宽受限且有噪声的信道中，为了不产生误差，信息的数据传输速率有上限值。

![](https://i0.hdslb.com/bfs/album/8cf3abcea450b7c332400a2ee25475df0a645f64.png)

1.  信道的带宽或信道中的<span style="background:#fff88f">信噪比越大</span>，则<span style="background:#fff88f">信息的极限传输速率就越高</span>。
2.  对一定的传输带宽和一定的信噪比，信息传输速率的上限就确定了。
3.  只要信息的传输速率低于信道的极限传输速率，就一定能找到某种方法来实现无差错的传输。
4.  <u>香农定理得出的为极限信息传输速率，实际信道能达到的传输速率要比它低不少</u>。
5.  从香农定理可以看出，<u>若信道带宽 W 或信噪比 S/N 没有上限（不可能），那么信道的极限信息传输速率也就没有上限</u>。

> 两者对比

:star:==注意==：如果题目中即出现 **信噪比**，又出现 **码元携带的比特数**，需要将 **奈式准则** 和 **香农定理** 都算出，比较大小，**选取数值较小的作为最大数据传输速率**。

![](https://pic.imgdb.cn/item/63d13beeface21e9efc998de.png)
![](https://pic.imgdb.cn/item/63d760d4face21e9ef982d1b.png)
![](https://pic.imgdb.cn/item/63d766b7face21e9efa37e91.png)

### 2.5 编码和调制

#### 1. 基带信号与宽带信号

<span style="background:#d2cbff">基带信号</span>：将数字信号 1 和 0 直接用两种不同的电压表示，再送到**数字信道**上去传输（基带传输）。（基带信号对应数字信道）

<span style="background:#d2cbff">宽带信号</span>：将基带信号进行调制后形成的频分复用模拟信号，再传送到**模拟信道**上去传输（宽带传输）。（宽带信号对应模拟信号）

在<span style="background:#fff88f">传输距离较近</span>时，计算机网络<span style="background:#fff88f">采用基带传输方式</span>。(近距离衰减小，从而信号内容不易发生变化)  
在<span style="background:#fff88f">传输距离较远</span>时，计算机网络<span style="background:#fff88f">采用宽带传输方式</span>。(远距离衰减大，即使信号变化大也能最后过滤出来基带信号)  

#### 2. 编码和调制

![](https://i0.hdslb.com/bfs/album/7ef4b1686434e72106a1a6db08aeffe3578baee6.png)

#### 3. 数字数据编码为数字信号
![](https://pic.imgdb.cn/item/63d142e4face21e9efdadf34.png)

> 非归零编码【NRZ】

<span style="background:#fff88f">高 1 低 0</span>  
*   **优点**：直观、编码很容易实现；不用归零，一个周期可以全部用来传输数据  
*   **缺点**：<u>缺少检错功能；无法判断一个码元的开始和结束，因此收发双方难以保持同步</u>  
![](https://i0.hdslb.com/bfs/album/05c0ddb9a1a0d2ecf289265b5118f46b97f481bc.png)

> 归零编码【RZ】

信号电平在 <span style="background:#fff88f">1个码元之内</span>，都要恢复到 <span style="background:#fff88f">零</span> 的这个编码方式。  
（<span style="background:#fff88f">1需要恢复成0，0依然是0</span>）  
*   **优点**：直观、编码很容易实现；由于需要归零，所以接收方可以根据该跳变调整本方的时钟基准，<u>提供了自同步机制</u>  
*   **缺点**：归零需要占用一部分带宽，传输效率会受到一定影响  
![](https://pic.imgdb.cn/item/63d142abface21e9efda6607.png)

> 反向不归零编码【NRZI】

信号电平<span style="background:#fff88f">翻转表示 0 </span>，信号电平<span style="background:#fff88f">不变表示 1 </span>。  
*   **优点**：翻转的信号本身可以作为一种通知机制，既能传输时钟信号，又能降低带宽损失  
*   **缺点**：<u>当发送端为全1时，还是有和NRZ一样的缺点</u>  
![](https://pic.imgdb.cn/item/63d22c8eface21e9efa66a02.png)


> 曼彻斯特编码

将一个码元分成两个相等的间隔，<span style="background:#affad1">前一个间隔为低电平</span> <span style="background:#fdbfff">后一个间隔为高电平</span> 表<span style="background:#fff88f">示码元 1； 码元 o 则正好相反</span>。<u>也可以采用相反的规定</u>。

**每一个码元都被调成两个电平，所以<span style="background:#fff88f">数据传输速率只有调制速率的 1/2</span>。**  
*   **优点**：在每个码元的中间出现电平跳变，位中间的跳变既作为时钟信号用于同步，又作为数据信号  
*   **缺点**：<u>所占频带宽度将会是原始基带宽度的两倍</u>  

![](https://i0.hdslb.com/bfs/album/94c18175dfc4fe8cd78a554ed6541ee464f3a479.png)

> 差分曼彻斯特编码

常用于局域网传输，其规则是: <span style="background:#fff88f">若码元为 1</span>，则<u>前半个码元的电平与上一个码元的后半个码元的电平相同</u>，<span style="background:#fff88f">若为 0</span>，<u>则相反</u>。

 *   **特点**：在每个码元的中间，都有一次电平的跳转，<u>可以实现自同步，且抗干扰性强于曼彻斯特编码</u>。  

![](https://i0.hdslb.com/bfs/album/ab244602032e49008fc9aff87ea45c23344b598a.png)

> 4B/5B编码

在比特流中插入额外的比特以打破一连串的0或1，就是<span style="background:#fff88f">用5个比特来编码4个比特的数据</span>，之后再传给接收方

#### 4. 数字数据调制为模拟信号（求放过，看不懂）

数字数据调制技术<span style="background:#fff88f">在发送端</span><u>将数字信号转换为模拟信号</u>，而<span style="background:#fff88f">在接收端</span><u>将模拟信号还原为数字信号</u>，分别对应于<u>调制解调器的调制和解调过程</u>。

![](https://pic.imgdb.cn/item/63d757e8face21e9ef87faac.png)

### 2.6 物理层传输介质

传输介质也称传输媒体 / 传输媒介，指数据传输系统中在发送设备和接收设备之间的<span style="background:#fff88f">物理通路</span>。

:star:==传输媒体并不是物理层==。

<span style="background:#fff88f">传输媒体在物理层的下面</span>，因为<u>物理层是体系结构的第一层，因此有时称传输媒体为 0 层</u>。在传输媒体中传输的是信号，但<u>传输媒体并不知道所传输的信号代表什么意思</u>。**但物理层规定了电气特性，因此能够识别所传送的比特流。**

![](https://i0.hdslb.com/bfs/album/af01e771b6aa15a3c5045beec22b3d9655f638ba.png)

> 导向型传输介质

1. 双绞线  
	双绞线：是古老、又最常用的传输介质；由**两根**采用一定规则**并排绞合的、相互绝缘的铜导线**组成
	
	*   绞合的目的是**为了减少相邻导线的电磁干扰**
	
	为了进一步提高电磁干扰能力，可以在双绞线的外面再加上一个由**金属丝**编织而成的**屏蔽层**，这就是**屏蔽双绞线（STP）**（<u>相应没有屏蔽层的双绞线就称为非屏蔽双绞线</u>（UTP））  
	![在这里插入图片描述](https://pic.imgdb.cn/item/63c0c511be43e0d30e546535.png)
	
	双绞线价格便宜，是最常用的传输介质之一，在<u>局域网和传统电话网</u>中普遍使用。**模拟传输和数字传输都可以使用双绞线**，其通信距离一般为<u>几公里到数十公里</u>。  
	距离太远时，对于**模拟传输**，要**用放大器放大衰减的信号**；对于**数字传输**，要**用中继器将失真的信号整形**
	
	生活中常见的双绞线样式如下  
	![在这里插入图片描述](https://pic.imgdb.cn/item/63c0c511be43e0d30e546541.png)

2. 同轴电缆  
	同轴电缆：由<u>导体铜质线、绝缘层、网状编址屏蔽层和塑料外层</u>构成；按特性阻抗数值不同，将同轴电缆分为以下两类
	
	*   **基带同轴电缆（50Ω）：** 主要用于传送**基带数字信号（数字传输）**，广泛应用于**局域网**
	*   **宽带同轴电缆（75Ω）：** 主要用于传送**宽带信号（模拟传输）**，用于**有线电视系统**
	
	同轴电缆具有良好的**抗干扰特性**，广泛应用于**传输较高速率的数据**，传输距离**更远**，但**价格较双绞线贵**  
	![在这里插入图片描述](https://pic.imgdb.cn/item/63c0c511be43e0d30e546550.png)
	
	*   同轴电缆的“同轴”指的<u>就是这个四部分共用一个轴线</u>  
	
	生活中常见的同轴电缆样式如下
	
	![在这里插入图片描述](https://pic.imgdb.cn/item/63c0c511be43e0d30e546567.png)

3. 光纤  
	A：<span style="background:#d2cbff">光纤通信（了解）</span>   
	**光纤通信：** 就是利用**光导纤维（光纤）** 传递**光脉冲**来进行通信（**有光脉冲表示1，反之为0**）；可见光的频率大约为108MHz，光纤通信的带宽是**远远大于**目前其他各种传输媒体的带宽的
	
	![在这里插入图片描述](https://pic.imgdb.cn/item/63c0c511be43e0d30e546596.png)
	
	光纤通信发出的是**光信号**，而计算机发送或识别的是**电信号**，因此整个过程中必然涉及**光电转换**。  
	具体来说：光纤在**发送端**有光源，可以采用**发光二极管或半导体激光器**，它们在电脉冲作用下能产生出光脉冲；在**接收端**用光电二极管做成**光检测器**，在检测到光脉冲时可还原出**电脉冲**
	
	B：<span style="background:#d2cbff">光纤</span>    
	光纤：主要由**纤芯（实心）和包层**构成，光波通过纤芯传导。由于包层折射率较低，因此当光线从高折射率的介质射向低折射率的介质时，此时折射角大于入射角，如果入射角足够大，就会出现全反射，也即当光线碰到包层时就会折射回纤芯。这个过程不断重复，光也就可以沿着光纤一直传输下去了
	
	![在这里插入图片描述](https://pic.imgdb.cn/item/63c0c511be43e0d30e546700.png)
	
	**光纤可以分为以下两种**  
	*   <span style="background:#d2cbff">多模光纤</span>：从不同角度入射的**多束光线**可以在**一条光纤**中传输；其光源为**发光二极管**；光脉冲在多模光纤中传输时会逐渐展宽，**造成失真**；只适用于**近距离传输**  
	    ![在这里插入图片描述](https://pic.imgdb.cn/item/63c0c511be43e0d30e546717.png)
	*   <span style="background:#d2cbff">单模光纤</span>：光纤的直径减小到仅一个**光波长度**时，光纤就像一根**波导**一样，可以使光线一直向前传播，而**不会产生多次反射**；其纤芯**很细**，制造成本**高**；单模光纤的光源为**定向性很好的激光二极管**；其**衰减较小**、适合**远距离传输**  
	    ![在这里插入图片描述](https://pic.imgdb.cn/item/63c0c511be43e0d30e546724.png)
	
	![](https://pic.imgdb.cn/item/63d28987face21e9ef94b6f0.png)
	
	C：<span style="background:#d2cbff">光纤特点</span>   
	*   传输**损耗小**，中继**距离长**，对**远距离传输**特别经济
	*   抗雷电和电磁干扰性能好
	*   无串音干扰，**保密性**好，也不易被窃听或截取数
	*   体积小，重量轻

> 非导向型传输介质

![](https://pic.imgdb.cn/item/63d28ae4face21e9ef992420.png)
![](https://pic.imgdb.cn/item/63d28b21face21e9ef9a02a3.png)
![](https://pic.imgdb.cn/item/63d28b81face21e9ef9b41af.png)


### 2.7 物理层设备

#### 1. 中继器

诞生原因: <u>由于存在损耗，在线路上传输的信号功率会逐渐衰减，衰减到一定程度时将造成信号失真，因此会导致接收错误</u>。

<span style="background:#d2cbff">中继器的功能</span>: <span style="background:#fff88f">对信号进行再生和还原，对衰减的信号进行放大，保持与原数据相同，以增加信号传输的距离，延长网络的长度</span>。

![](https://pic.imgdb.cn/item/63d29392face21e9efb56aec.png)

中继器的两端: <span style="background:#fff88f">两端的网络部分是网段</span>，<span style="background:#ff4d4f">而不是子网</span>，**适用于完全相同的两类网络的互连，且两个网段速率要相同**。（后面会讲解网段，子网的相关内容）

*   中继器只将任何电缆段上的数据发送到另一段电缆上，它**仅作用于信号的电气部分**，并不管数据中是否有错误数据或不适于网段的数据。
*   两端可连相同媒体，也可连不同媒体。
*   **中继器两端的网段一定要是同一个协议**。（<u>中继器不会存储转发，傻</u>)

#### 2. 集线器（多口中继器）

<span style="background:#d2cbff">集线器的功能</span>: <span style="background:#fff88f">对6信号进行再生放大转发，对衰减的信号进行放大，接着转发到其他所有（除输入端口外）处于工作状态的端口上，以增加信号传输的距离，延长网络的长度</span>。<u>不具备信号的定向传送能力，是一个共享式设备</u>。(就是个广播)

![](https://i0.hdslb.com/bfs/album/55b0670af6055f706944aeee5da4feaaa1b90846.png)


## 三、数据链路层
--------

### 3.1 功能概述

> 一些基本概念

*   <span style="background:#d2cbff">结点</span>：每个<span style="background:#fff88f">主机、路由器</span>被称为一个结点。  
*   <span style="background:#d2cbff">链路</span>：网络中两个结点之间的**物理通道**，链路的传输介质主要有双绞线、光纤和微波。分为<span style="background:#fff88f">有线链路、无线链路</span>。  
*   <span style="background:#d2cbff">数据链路</span>：网络中两个结点之间的**逻辑通道**，<span style="background:#fff88f">把实现控制数据传输协议的硬件和软件加到链路上</span>就构成数据链路。  
*   <span style="background:#d2cbff">帧</span>：链路层的协议数据单元，**封装网络层数据报**。  

数据链路层负责通过一条链路从一个结点向另一个物理链路直接相连的相邻结点传送帧。（搬运工的角色）

> 功能概述

数据链路层在物理层提供服务的基础上向网络层提供服务。  
:star:<span style="background:#fff88f">最基本的服务</span>是<u>将源自网络层来的数据可靠地传输到相邻节点的目标机网络层</u>。  
:star:<span style="background:#fff88f">主要作用</span>是<u>加强物理层传输原始比特流的功能，将物理层提供的可能出错的物理连接改造成为逻辑上无差错的数据链路，使之对网络层表现为一条无差错的链路</u>。  

漫画解释：  
![](https://i0.hdslb.com/bfs/album/96db465137339760c4ba48180838612b09d296b2.png)

*   功能一：为网络层提供服务。（无确认无连接服务，有确认无连接服务，有确认面向连接服务。）
*   功能二：链路管理，即连接的建立、维持、释放（用于面向连接的服务）。
*   功能三：组帧。
*   功能四：流量控制。
*   功能五：差错控制（帧错 / 位错）。  

### 3.2 封装成帧 & 透明传输

*   <span style="background:#d2cbff">封装成帧</span>：<span style="background:#fff88f">指在一段数据的前后添加首部和尾部，构成一个帧</span>。  

*   首部和尾部包含许多的控制信息，他们的一个重要作用: **帧定界（确定帧的界限）**。<u>通过 帧定界 确定帧的开始和结束</u>。 <span style="background:#fff88f">接收端在收到物理层上交的比特流后，根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束。</span>   

	<span style="background:#d2cbff">帧同步</span>：**接收方**应当能从接收到的二进制比特流中区分出帧的起始和终止。  

*   <span style="background:#d2cbff">组帧的四种方法</span>: 1. 字符计数法，2. 字符 (节）填充法，3. 零比特填充法，4. 违规编码法。


![](https://i0.hdslb.com/bfs/album/714237deb054cb5c78875aa22bb8545527da57ae.png)

* 透明传输
	透明传输<span style="background:#fff88f">指不管所传数据是什么样的比特组合，都应当能够在链路上传送</span>。  
	
	<u>如果所传数据的比特组合与某个控制信号完全相同，需要采取适当的措施，防止接收方误认为某种控制信号。保证数据链路层的传输是透明的</u>。  

下面来介绍组帧的四种方法。

#### 1. 字符计数法

*   帧首部使用一个计数字段，也就是==每个帧的第一个字节==（八位）<span style="background:#fff88f">来标明帧内字符数</span>。

![](https://i0.hdslb.com/bfs/album/7c8e25572804fc4c2338480bf6bee5c7805ef407.png)

==缺陷==：<span style="background:#fff88f">第一个数错误的话，剩下的就全部错误</span>了。因此不经常使用。

#### 2. 字符填充法

*   联想 java 中的转义字符。  
防止接收端**误认为**中间部分的字段为<u>开始字符SOH</u>和<u>结束字符EOT</u>（包括转义字符ESC等），通常**添加类似转义字符ESC**，跳过该字段，知道遇到真正的结束字符。

![](https://i0.hdslb.com/bfs/album/64c1f74396c7c4af6e58d9959a005e41e9c9db9b.png)

#### 3. 零比特填充法

![](https://i0.hdslb.com/bfs/album/2f7737cd5d4d9465b9b298608794de14a6400b3e.png)

==注意==：首位标志字段是<span style="background:#fff88f"> 连续的 6 个 1</span>  
为了信息字段与首位进行区别，操作如下：  
1. 在<span style="background:#fff88f">发送端</span>，扫描整个信息字段，<u>只要连续 5 个 1，就立即填入 1 个 0</u>。   
2. 在<span style="background:#fff88f">接收端</span>收到一个帧时，先找到标志字段确定边界，再用硬件对比特流进行扫描。<u>发现连续 5 个 1 时，就把后面的 0 删除</u>。

![](https://i0.hdslb.com/bfs/album/6726bda34b4e510a8c745f18dc5a4dd4eba47d62.png)

**保证了透明传输: 在传送的比特流中可以传送任意比特组合，而不会引起对帧边界的判断错误**。

#### 4. 违规编码法

![](https://i0.hdslb.com/bfs/album/80339b6a324b657807f1bdcdbd436d14dc58c607.png)

<span style="background:#fff88f">可以用 “高 - 高”，“低 - 低” 来定界帧的起始和终止</span>。

==总结==：
由于<span style="background:#fff88f">字节计数法</span>中 Count 字段的脆弱性（其值若有差错将导致灾难性后果）及字符填充实现上的复杂性和不兼容性，目前较**普遍使用的帧同步法**是<u>比特填充和违规编码法</u>。  

****
### 3.3 差错控制（检错编码）

#### 1. 差错从哪来

概括来说，<span style="background:#fff88f">传输中的差错都是由于噪声引起的</span>。

全局性：1. 由于线路本身电气特性所产生的随机噪声 (热噪声)，是信道固有的，随机存在的。  
解决办法: 提高信噪比来减少或避免干扰。(对传感器下手)

局部性：2. 外界特定的短暂原因所造成的冲击噪声，是产生差错的主要原因。  
解决办法: 通常利用编码技术来解决。

*   差错种类

![](https://i0.hdslb.com/bfs/album/5eb7daff53767cfd6807ab76bdd602c988a99ff7.png)

![](https://img-blog.csdnimg.cn/img_convert/ff8ae111b4bceec5ec15a6ce84d65597.png)

#### 2. 差错控制（位错）

![](https://i0.hdslb.com/bfs/album/8a6189b8c03c0e74c41223aa0b9b98bc4510b13b.png)

> 冗余编码

在数据发送之前，先按某种关系附加上一定的冗余位，构成一个符合某一规则的码字后再发送。当要发送的有效数据变化时，相应的冗余位也随之变化，使码字遵从不变的规则。接收端根据收到码字是否仍符合原规则，从而判断是否出错。

> 奇偶校验码

*   注意：“1” 的个数包括检验元

![](https://i0.hdslb.com/bfs/album/be8cf682376dd325dd86fb1446819482c0d03606.png)


> CRC 循环校验码

![](https://i0.hdslb.com/bfs/album/29eb1837edd111995231f682e8a3c8519e215c65.png)

*   接收端如何检错  
    把收到的每一个帧都除以同样的除数，然后检查得到的余数 R。
    
    1. 余数为 0，判定这个帧没有差错，接受。  
    2. 余数为不为 0，判定这个帧有差错（无法确定到位），丢弃。
    
    FCS 的生成以及接收端 CRC 检验都是由硬件实现，处理很迅速，因此不会延误数据的传输。
    

### 3.4 差错控制（纠错编码——海明码）

*   **海明码: 发现双比特错，纠正单比特错。**

![](https://i0.hdslb.com/bfs/album/ee5dd6ead2d6ee2f40685d6cb5d94d169340486d.png)

#### 1. 确定校验码的位数 r

![](https://i0.hdslb.com/bfs/album/7a5ec5ee3d9ac7d0299be23ef977490cba5e5e8f.png)

#### 2. 确定校验码和数据的位置

*   校验码放在 2 的几次方的位置，如 2^0,2^1,2^2…

![](https://i0.hdslb.com/bfs/album/ed212e03275d3c66b0c0a35873ba7b61bd13e108.png)

#### 3. 求出校验码的值

*   首先写出数据位对应的二进制，二进制位数由数据位最后一位（在下面的例子中为 10）确定。所以是 4 位。
*   P1 的值是所有二进制最后一位为 1 的实际值异或为 0。 如何解释？

1. P1最后一位为1，先找出二进制最后一位与P1相同的有D1,D2,D4,D5。
2. 对他们代表的实际值进行异或。P1 设为 x
3. x⊕1⊕0⊕1⊕0=0 所以 x=0 即 P1=0。

例：P2第三位为1，先找出二进制第三位与P2相同的有……

![](https://i0.hdslb.com/bfs/album/3884de06f8c8f964b55669e8bce78c7400a6d515.png)

#### 4. 检错并纠错

![](https://i0.hdslb.com/bfs/album/9ebda0789ce494611724bf720db3ebc3333ebb93.png)

**对所有要校验的位进行异或运算。**

eg：对第一位进行异或运算。

P1⊕D1⊕D2⊕D4⊕D5=1。  
再对第二位、第三位…依次进行异或  
按从高到低的顺序进行排序。 为 0101=5。 所以判定第五位是错的。纠错即可。

### 3.5 流量控制和可靠传输机制

**较高的发送速度和较低的接收能力**的不匹配，会造成传输出错，因此流量控制也是数据链路层的一项重要工作。

> 数据链路层和传输层流量控制的区别

数据链路层的流量控制是点对点的，而传输层的流量控制是端到端的。

数据链路层流量控制手段: 接收方收不下就不回复确认。

传输层流量控制手段: 接收端给发送端一个窗口公告。

> 流量控制的方法

![](https://i0.hdslb.com/bfs/album/377d1c67d476d9d1bf54bdaebbae1774a48779fb.png)

*   三者的区别

![](https://i0.hdslb.com/bfs/album/1aa4d1e7d9254246b801f800346ff32e30bfd5ab.png)

*   可靠传输，流量控制，滑动窗口

![](https://i0.hdslb.com/bfs/album/01b8d303911380887c8dda83db63666677c68cc5.png)

### 3.6 停止——等待协议

![](https://i0.hdslb.com/bfs/album/7a5a21387c7700fb3c84db70aa1c59772deee935.png)

*   下面来介绍一下停等协议的几种应用情况

#### 1. 无差错情况

![](https://i0.hdslb.com/bfs/album/47a0b6aa442040eb035ee7b167edc8a85aa0a20b.png)

#### 2. 数据帧丢失或者帧出错

![](https://i0.hdslb.com/bfs/album/552f8b6926738aaddac5227d42d36cc83c6b4106.png)

#### 3.ACK（确认帧）丢失

![](https://i0.hdslb.com/bfs/album/b43ad3ecd14fc7a471e0f98616fb602f20485550.png)

#### 4.ACK 迟到

![](https://i0.hdslb.com/bfs/album/7f65b1062554945eca0416f5c15bda80cd63bd25.png)

#### 5. 信道利用率

![](https://i0.hdslb.com/bfs/album/7bfe2903ea9c96978c049989314d778c477c3a4f.png)

![](https://i0.hdslb.com/bfs/album/6906a27a232931becff9a7f678192571f7a3ef6c.png)

### 3.7 后退 N 帧协议（GBN）

#### 1. 图解

![](https://i0.hdslb.com/bfs/album/04ba4b3d41bfc9f33fac97e43416d1e07d3bdb00.png)

#### 2.GBK 发送方必须响应的三件事

1.  上层的调用  
    上层要发送数据时，发送方先检查发送窗口是否已满，如果未满，则产生一个帧并将其发送; 如果窗口已满，发送方只需将数据返回给上层，暗示上层窗口已满。上层等一会再发送。(实际实现中，发送方可以缓存这些数据，窗口不满时再发送帧)。
2.  收到了一个 ACK  
    GBN 协议中，对 n 号帧的确认采用**累积确认**的方式，**标明接收方已经收到 n 号帧和它之前的全部帧。**
3.  超时事件  
    协议的名字为后退 N 帧 / 回退 N 帧，来源于出现丢失和时延过长帧时发送方的行为。就像在停等协议中一样，定时器将再次用于恢复数据帧或确认帧的丢失。**如果出现超时，发送方重传所有已发送但未被确认的帧。**

#### 3.GBN 接收方要做的事

如果正确收到 n 号帧，并且按序，那么接收方为 n 帧发送一个 ACK，并将该帧中的数据部分交付给上层。

其余情况都丢弃帧，**并为最近按序接收的帧重新发送 ACK**（如图所示）。接收方无需缓存任何失序帧，只需要维护一个信息: expectedseqnum(下一个按序接收的帧序号）。

![](https://i0.hdslb.com/bfs/album/ca7e72fe577c9b930366a4241c2b7ffec869b166.png)

#### 4. 滑动窗口的长度

**若采用 n 个比特对帧编号，那么发送窗口的尺寸 w 应满足: 1≤w≤2^n-1**。因为发送窗口尺寸过大，就会使得接收方无法区别新帧和旧帧。

#### 5. 性能分析

优点：因连续发送数据帧而提高了信道利用率。

缺点：在重传时必须把原来已经正确传送的数据帧重传，使传送效率降低。

选择重传协议可以解决这个问题。

### 3.8 选择重传协议（SR）

那么如何解决后退 N 帧协议的缺点呢？

解决办法: 设置单个确认，同时加大接收窗口，设置接收缓存，缓存乱序到达的帧。

#### 1. 滑动窗口

![](https://i0.hdslb.com/bfs/album/cc8658bd656d3901cac4bca0a539ab51316e8e28.png)

#### 2.SR 发送方必须响应的三件事

1.  上层的调用  
    从上层收到数据后，SR 发送方检查下一个可用于该帧的序号，如果序号位于发送窗口内，则发送数据帧; 否则就像 GBN 一样，要么将数据缓存，要么返回给上层之后再传输。
    
2.  收到了一个 ACK  
    如果收到 ACK，加入该帧序号在窗口内，则 SR 发送方将那个被确认的帧标记为已接收。如果该帧序号是窗口的下界（最左边第一个窗口对应的序号)，则窗口向前移动到具有最小序号的未确认帧处。如果窗口移动了并且有序号在窗口内的未发送帧，则发送这些帧。
    
3.  超时事件
    
    每个帧都有自己的定时器，一个超时事件发生后只重传一个帧。
    

#### 3.SR 接收方要做的事

![](https://i0.hdslb.com/bfs/album/d3bbd1b29339d3f4408398f181f9dfd6e8698879.png)

#### 4. 滑动窗口长度

![](https://i0.hdslb.com/bfs/album/9bab3c4e9595cd948d55ed09b17cc719146ca7bf.png)

### 3.9 信道划分介质访问控制

#### 1. 传输数据用到的两种链路

*   点对点链路 : 两个相邻节点通过一个链路相连，没有第三者。应用: PPP 协议，常用于广域网。
*   广播式链路 : 所有主机共享通信介质。应用: 早期的总线以太网、无线局域网，常用于局域网。典型拓扑结构: 总线型、星型（逻辑总线型)

#### 2. 介质访问控制

介质访问控制的内容就是，采取一定的措施，使得两对节点之间的通信不会发生互相干扰的情况。

![](https://i0.hdslb.com/bfs/album/d3376d8a64c5de6be5b1364ed8717c7ce5426a9b.png)

#### 3. 信道划分介质访问控制

信道划分介质访问控制: 将使用介质的每个设备与来自同一信道上的其他设备的通信隔离开，把时域和频域资源合理地分配给网络上的设备。

![](https://i0.hdslb.com/bfs/album/37df35a8205548d7e7ba97f2b4ba80e49a5c5936.png)

*   下面来介绍几种多路复用技术。

#### 4. 频分多路复用 FDM

用户在分配到一定的频带后，在通信过程中自始至终都占用这个频带。频分复用的所有用户在同样的时间占用不同的带宽（频率带宽）资源。  
优点：充分利用传输介质带宽，系统效率较高 ; 由于技术比较成熟，实现也比较容易。

![](https://i0.hdslb.com/bfs/album/9486e43103b0d8f6ffca75af245f2c2fef0af995.png)

#### 5. 时分多路复用 TDM

将时间划分为一段段等长的时分复用帧（TDM 帧)。每一个时分复用的用户在每一个 TDM 帧中占用固定序号的时隙，所有用户轮流占用信道。

这样做有一个弊端，就是当 ABC 都不传输数据的时候，D 仍然要等待，不能直接传输。信道利用率只有 1/4.

![](https://i0.hdslb.com/bfs/album/f54b969d3293d50478e5dc3a60fae464f62190a7.png)

#### 5. 改进时分复用——统计时分复用 STDM

*   ABCD 中任何一个想传输数据时，直接发送即可。不用等到自己的时间段，信道利用率大大提高。

![](https://i0.hdslb.com/bfs/album/f9bf4c121701aa29a2f943e766495c696647f4e7.png)

#### 6. 波分多路复用 WDM

波分多路复用就是**光的频分多路复用**，在一根光纤中传输多种不同波长（频率）的光信号，由于波长（频率) 不同，所以各路光信号互不干扰，最后再用波长分解复用器将各路波长分解出来。

![](https://i0.hdslb.com/bfs/album/0c00fb045d3dcdf19dfc831887f75ddbbcc07798.png)

#### 7. 码分多路复用（CDMA）

*   码分多址 (CDMA）是码分复用的一种方式。
*   1 个比特分为多个码片 / 芯片 (chip），**每一个站点被指定一个唯一的 m 位的芯片序列**。发送 1 时站点发送芯片序列，发送 0 时发送芯片序列反码（通常把 0 写成 - 1）。
*   如何不打架: 多个站点同时发送数据的时候，要求各个站点芯片序列相互正交。
*   如何合并: 各路数据在信道中被线性相加。
*   如何分离: 合并的数据和源站规格化内积。

这个部分比较难理解，建议结合书和视频多看几遍。

> 接下来会将 随机访问介质访问控制 中的几种协议。

### 3.10 ALOHA 协议

*   ALOHA 协议分为两种，纯 ALOHA 协议和时隙 ALOHA 协议。接下来分别介绍他们。

#### 1. 纯 ALOHA 协议

纯 ALOHA 协议思想: 不监听信道，不按时间槽发送，随机重发。**想发就发**

![](https://i0.hdslb.com/bfs/album/9e82581f4c8d5ef556fc22984f63ecfbc48f1ee9.png)

#### 2. 时隙 ALOHA 协议

时隙 ALOHA 协议的思想: 把时间分成若干个相同的时间片，所有用户在时间片开始时刻同步接入网络信道，若发生冲突，则必须等到下一个时间片开始时刻再发送。 **控制想发就发的随意性**

![](https://i0.hdslb.com/bfs/album/01dbbf044fb1d2895d895c61c72d5ec5c30e8c79.png)

### 3.11 CSMA 协议

**CS**: 载波侦听 / 监听，每一个站在**发送数据之前**要检测一下总线上是否有其他计算机在发送数据。

如何检测？

当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加)。当一个站检测到的信号电压摆动值超过一定门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了碰撞，即发生了冲突。

**MA** : 多点接入，表示许多计算机以多点接入的方式连接在一根总线上。

**协议思想: 发送帧之前，监听信道。**

![](https://i0.hdslb.com/bfs/album/d8c79a07f158812721b55c5d6d1cd1f815783dd5.png)

#### 1. 1—坚持 CSMA

*   坚持指的是对于监听信道忙之后的坚持。
    
*   1 - 坚持 CSMA 思想: 如果一个主机要发送消息，那么它先监听信道。  
    **空闲则直接传输，不必等待。**  
    **忙则一直监听，直到空闲马上传输。**
    
*   如果有冲突 (一段时间内未收到肯定回复〉，则等待一个随机长的时间再监听，重复上述过程。
    
*   优点: 只要媒体空闲，站点就马上发送，避免了媒体利用率的损失。
    
*   缺点: 假如有两个或两个以上的站点有数据要发送，冲突就不可避免。
    

#### 2. 非坚持 CSMA

*   非坚持指的是对于监听信道忙之后就不继续监听。
*   非坚持 CSMA 思想: 如果一个主机要发送消息，那么它先监听信道。  
    **空闲则直接传输，不必等待。**  
    **忙则等待一个随机的时间之后再进行监听。**
*   优点: 采用随机的重发延迟时间可以减少冲突发生的可能性。
*   缺点: 可能存在大家都在延迟等待过程中，使得媒体仍可能处于空闲状态，媒体使用率降低。

#### 3.P—坚持 CSMA

*   p - 坚持指的是对于监听信道空闲的处理。
*   p - 坚持 CSMA 思想: 如果一个主机要发送消息，那么它先监听信道。  
    **空闲则以 p 概率直接传输，不必等待; 概率 1-p 等待到下一个时间槽再传输。忙则等待一个随机的时间之后再进行监听。**
*   优点: 既能像非坚持算法那样减少冲突，又能像 1 - 坚持算法那样减少媒体空闲时间的这种方案。
*   发生冲突后还是要坚持把数据帧发送完，造成了浪费。

#### 4. 对比总结

![](https://i0.hdslb.com/bfs/album/5477cf08e027606db554cbcbecbe1d203dd4f33c.png)

### 3.12 CSMA/CD 协议

**CS**: 载波侦听 / 监听，每一个站在**发送数据之前**以及**发送数据时**都要检测一下总线上是否有其他计算机在发送数据。

MA: 多点接入，表示许多计算机以多点接入的方式连接在一根总线上。（总线型网络）

**CD: **碰撞检测（冲突检测)，**“边发送边监听”**，适配器边发送数据边检测信道上信号电压的变化情况，以便判断自己在发送数据时其他站是否也在发送数据。 （半双工网络）

问：监听之后为啥还会发生冲突呢？

答：**因为电磁波在总线上总是以有限的速率传播的。**

问：最迟多久才能知道自己发送的数据没和别人碰撞?

答：最多是两倍的总线端到端的传播时延（2T)

**总线的端到端往返传播时延只要经过 2z 时间还没有检测到碰撞，就能肯定这次发送不会发生碰撞。**

问：如何确定碰撞后的重传时机?

答：

![](https://i0.hdslb.com/bfs/album/e84f7e07a849e23926e15c5fb552d9ef9d98f221.png)

若连续多次发生冲突, 就表明可能有较多的站参与争用信道。使用此算法可使重传需要推迟的平均时间随重传次数的增大而增大，因而减小发生碰撞的概率，有利于整个系统的稳定。

> 最小帧长问题

如果帧的长度太小，可能在站点停止传送之前，就已经传送完了。因此需要确定一个最小帧长。

![](https://i0.hdslb.com/bfs/album/1a4c801b1b68a5817de482fbd2f98e6c7f18f305.png)

### 3.13 CSMA/CA 协议

CSMA/CA 主要用于无线局域网。CSMA/CD 主要用于有线局域网。

![](https://i0.hdslb.com/bfs/album/2960127d6179778397a245e42cffdcac16086f15.png)

> 工作原理

*   发送数据前，先检测信道是否空闲。
*   空闲则发出 RTS (request to send），RTS 包括发射端的地址、接收端的地址、下一份数据将持续发送的时间等信息;
*   信道忙则等待。
*   接收端收到 RTS 后，将响应 CTS (clear to send)。
*   发送端收到 CTS 后，开始发送数据帧（**同时预约信道: 发送方告知其他站点自己要传多久数据**）。接收端收到数据帧后，将用 CRC 来检验数据是否正确，正确则响应 ACK 帧。
*   发送方收到 ACK 就可以进行下一个数据帧的发送，若没有则一直重传至规定重发次数为止 (采用二进制指数退避算法来确定随机的推迟时间)。

> CSMA/CA 和 CSMA/CD 对比

![](https://i0.hdslb.com/bfs/album/86b129462e60e71c40629feb08b2ec8bc4e2420e.png)

### 3.14 轮训访问介质控制访问

*   优点： 既要不产生冲突，又要发送时占全部带宽。

#### 1. 轮训协议

![](https://i0.hdslb.com/bfs/album/65615812a2a42ef896f875d9b076ef59b86685c3.png)

#### 2. 令牌传递协议

![](https://i0.hdslb.com/bfs/album/04cab1c55062187b14034ab919860c5ce1ec849a.png)

> 以下几节的内容都不是重点，了解即可。

### 3.15 局域网基本概念和体系结构

局域网 (Local Area Network): 简称 LAN，是指在某一区域内由多台计算机互联成的计算机组，使用广播信道。

*   特点 1: 覆盖的地理范围较小，只在一个相对独立的局部范围内联，如一座或集中的建筑群内。
    
*   特点 2: 使用专门铺设的传输介质（双绞线、同轴电缆）进行联网，数据传输速率高（10Mb/s~10Gb/s）
    
*   特点 3: 通信延迟时间短，误码率低，可靠性较高。
    
*   特点 4: 各站为平等关系，共享传输信道。
    
*   特点 5: 多采用分布式控制和广播式通信，能进行广播和组播。
    
    **决定局域网的主要要素为: 网络拓扑，传输介质与介质访问控制方法。**
    

#### 1. 拓扑结构

![](https://i0.hdslb.com/bfs/album/d074e270f3df395dad038298188d470b2e19ad44.png)

#### 2. 传输介质

![](https://i0.hdslb.com/bfs/album/05c7ac719a96b6869405804b1e615ea36bbe0e33.png)

#### 3. 介质访问控制方法

![](https://i0.hdslb.com/bfs/album/618a4ad5748f9f0686233ac533e7f81f2115d959.png)

#### 4.MAC 子层和 LLC 子层

![](https://i0.hdslb.com/bfs/album/9785074baf638ba0970dba52ce18e87ddef49d01.png)

### 3.16 以太网

#### 1. 概述

![](https://i0.hdslb.com/bfs/album/ac49404911ba39c74f63fed3521f5b1ae919628e.png)

#### 2. 提供无连接，不可靠的服务

*   无连接: 发送方和接收方之间无 “握手过程”。
*   不可靠: 不对发送方的数据帧编号，接收方不向发送方进行确认，差错帧直接丢弃，差错纠正由高层负责
*   **以太网只实现无差错接收，不实现可靠传输。**

#### 3. 10BASE—T 以太网

![](https://i0.hdslb.com/bfs/album/31823fccbdb3b7e68123d44dcf9be2d787e20130.png)

#### 4. 适配器与 MAC 地址

*   **计算机与外界有局域网的连接是通过通信适配器的。**

![](https://i0.hdslb.com/bfs/album/a86cc547bcfb34f3321809e2cb7f19e621771652.png)

#### 5. MAC 帧

![](https://i0.hdslb.com/bfs/album/91c637b8d336d7e579cca27b9bcabe169d58ad3d.png)

### 3.17 PPP 协议和 HDLC 协议

> 在介绍这两个协议之前，先了解一下广域网。

#### 1. 广域网

广域网（WAN，Wide Area Network)，通常跨接很大的物理范围，所覆盖的范围从几十公里到几千公里，它能连接多个城市或国家，或横跨几个洲并能提供远距离通信，形成国际性的远程网络。

广域网的通信子网主要使用**分组交换技术**。广域网的通信子网可以利用公用分组交换网、卫星通信网和无线分组交换网，它将分布在不同地区的局域网或计算机系统互连起来，达到**资源共享**的目的。如因特网（Internet) 是世界范围内最大的广域网。

**局域网强调信息传递，广域网强调资源共享。**

![](https://i0.hdslb.com/bfs/album/e1a955aaeeba08a52ebcb9aa7253f55849dff3b9.png)

#### 2.PPP 协议

> 特点

点对点协议 PPP (Point-to-Point Protocol) 是目前使用最广泛的数据链路层协议，用户使用拨号电话接入因特网时一般都使用 PPP 协议。  
**只支持全双工链路。**

> 满足的要求

*   简单 对于链路层的帧，无需纠错，无需序号，无需流量控制。
*   封装成帧 帧定界符
*   透明传输 与帧定界符一样比特组合的数据应该如何处理: 异步线路用字节填充，同步线路用比特填充。
*   多种网络层协议 封装的 IP 数据报可以采用多种协议。
*   多种类型链路 串行 / 并行，同步 / 异步，电 / 光…
*   差错检测 错就丢弃。
*   检测连接状态 链路是否正常工作。
*   最大传送单元 数据部分最大长度 MTU。
*   网络层地址协商 知道通信双方的网络层地址。
*   数据压缩协商

> 无需满足的要求

*   纠错
*   流量控制
*   序号
*   不支持多点线路

> 组成部分

![](https://img-blog.csdnimg.cn/img_convert/e3d9401f8bc5337e8f8d2157dc710204.png)

> PPP 协议的状态图

![](https://i0.hdslb.com/bfs/album/1b5d4c4509208647578c66e215378573c427adf4.png)

> PPP 协议的帧格式

![](https://i0.hdslb.com/bfs/album/1e762347a68ffaea5445521caeeaf02faa7d6443.png)

#### 3.HDLC 协议

> 简介

![](https://i0.hdslb.com/bfs/album/ef5915603a3b2dee13b45af8e3e28d49d5025739.png)

> HDLC 的站

![](https://i0.hdslb.com/bfs/album/56cd80e2cf8e34b4a740124fa83172eebfb1d148.png)

> 帧格式

![](https://i0.hdslb.com/bfs/album/a17f3462afe68d60994d1929818403564ecb101c.png)

#### 4. 两种协议对比

![](https://i0.hdslb.com/bfs/album/109f5a49f0041862c7bfe9db8b92199f04ad6094.png)

### 3.18 链路层设备

#### 1. 网桥

网桥根据 **MAC 帧的目的地址**对帧进行**转发和过滤**。当网桥收到一个帧时，并不向所有接口转发此帧，而是先检查此帧的目的 MAC 地址，然后再确定将该帧转发到哪一个接口，或者是把它丢弃（即过滤）。

![](https://i0.hdslb.com/bfs/album/85c20083f8f766d487efc15f0ba8a8086300d496.png)

网桥分为透明网桥和源路由网桥。

*   透明网桥:“透明” 指以太网上的站点并不知道所发送的帧将经过哪几个网桥，是一种即插即用设备（通过自学习算法来提高效率）。
    
*   源路由网桥: 在发送帧时，把详细的最佳路由信息（路由最少 / 时间最短）放在帧的首部中。
    
    如何发现最佳路由信息呢？
    
    方法 : 源站以广播方式向欲通信的目的站发送一个发现帧。可能有好几个路径到达目的栈，发现帧会记录到达的时间，返回给源站，由此确定最佳路由信息。
    

![](https://i0.hdslb.com/bfs/album/822f2c111fa16806a2d5dd77f4c9e477bc53228f.png)

#### 2. 以太网交换机

以太网交换机就是多端口的网桥。现在基本上都在使用以太网交换机。分为两类。

![](https://i0.hdslb.com/bfs/album/f970589266234e8349a63e783f8f7350f67815f5.png)

#### 3. 冲突域和广播域

*   冲突域: 在同一个冲突域中的每一个节点都能收到所有被发送的帧。简单的说就是同一时间内只能有一台设备发送信息的范围。
*   广播域: 网络中能接收任一设备发出的广播帧的所有设备的集合。简单的说如果站点发出一个广播信号，所有能接收收到这个信号的设备范围称为一个广播域。

**重点**

![](https://i0.hdslb.com/bfs/album/5428cc956e743a179214c1c4a3531a022b405e3d.png)

## 四、网络层
------

### 4.1 网络层功能概述

主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。网络层传输单位是数据报。

分组和数据报的关系：把数据报进行切割之后，就是分组。

功能一: 路由选择与分组转发（最佳路径）

功能二: 异构网络互联

功能三: 拥塞控制（若所有结点都来不及接受分组，而要丢弃大量分组的话，网络就处于拥塞状态。因此要采取一定措施，缓解这种拥塞。）

方法：开环控制（静态）闭环控制（动态）

### 4.2 数据交换方式

#### 1. 电路交换

![](https://i0.hdslb.com/bfs/album/46c4bb07e7e8fdaa158ecdccc5dfebacace68270.png)

*   优缺点

![](https://i0.hdslb.com/bfs/album/157cc2b1e6953eada8a0578ab00c1ad7f036b2c8.png)

#### 2. 报文交换

![](https://i0.hdslb.com/bfs/album/9cdb669c6ddde2ba66f9f05119b9dbdfec518d9e.png)

*   优缺点

![](https://i0.hdslb.com/bfs/album/d9ef39a4f88dc790fd51ebaa50bb1e364082fd16.png)

#### 3. 分组交换

![](https://i0.hdslb.com/bfs/album/0b08511502fd5aa3d913bc7001bb7cdfc65725bb.png)

*   优缺点

![](https://i0.hdslb.com/bfs/album/2e9078cba94f7f693e81d7a1c90bb7738497e88c.png)

#### 4. 三种方式对比

![](https://i0.hdslb.com/bfs/album/d049cb2cce84eb5d112546ae0d1d9b991f8c2700.png)]

#### 5. 传输单元名词辨析

*   应用层——> 报文
*   传输层——> 报文段
*   网络层——> IP 数据报，分组（数据报拆分后就是分组）
*   数据链路层——> 帧
*   物理层——> 比特流

#### 6. 数据报方式 && 虚电路方式

*   数据报方式为网络层提供**无连接服务**。
    
    无连接服务: 不事先为分组的传输确定传输路径，每个分组独立确定。传输路径，不同分组传输路径可能不同。
    
*   虚电路方式为网络层提供**连接服务**。
    
    连接服务: 首先为分组的传输确定传输路径（建立连接），然后沿该路径（连接）传输系列分组，系列分组传输路径相同，传输结束后拆除连接。
    

> 数据报

![](https://i0.hdslb.com/bfs/album/d12278ce9f34472f7db75d8d8fcd158ae09d3568.png)

> 虚电路

![](https://i0.hdslb.com/bfs/album/4bbeea2106639c67d15b6d45bb6f8ee909766811.png)

> 对比

![](https://i0.hdslb.com/bfs/album/4e0b03229b4f4559d940e833eee397444897c373.png)

### 4.3 IP 数据报格式

![](https://i0.hdslb.com/bfs/album/743e6f1d0cc5f0a6c02c46670de5e59bae8a1a27.png)

*   详细图解 (中间的标识，标志，偏移量在下一小节中进行讲解)

![](https://i0.hdslb.com/bfs/album/32bc2d7f995761d77b74355eb35730024dac7e9e.png)

### 4.4 IP 数据报分片

![](https://i0.hdslb.com/bfs/album/835747b90cd3a02a421ab881faa9bf70ab407ecb.png)

*   中间三个的含义

![](https://i0.hdslb.com/bfs/album/d55dc5f907d602e5047e7ed42e46f26390659d29.png)

*   下面通过一个例题来加深理解。

主要看偏移量。

数据部分的第一个字节位置为 0。所以数据报片 1 的偏移量为 0。 数据报片 2 起始地址为 1400B。 偏移量单位为 8B, 所以偏移量为 1400/8=175。 数据报片 3 同理。

![](https://i0.hdslb.com/bfs/album/e309c1edae5d33723aa6566082043f0c919eb7f9.png)

### 4.5 分类的 IPv4 地址

*   一个路由器有多个 IP 地址，每一个端口都有一个 IP 地址
*   IP 地址由网络号和主机号组成。
*   为了人类方便识别，我们经常使用点分十进制来表示 IP 地址。

![](https://i0.hdslb.com/bfs/album/67a516d315fb855ed0f0403b4688df3bd6cecc8d.png)

> IP 地址的分类

*   根据网络号所占字节的多少，将 IP 地址分为 5 类。之所以会减一，减二，是因为含有一些特殊的 IP 地址。

![](https://i0.hdslb.com/bfs/album/448f20cf188e87dcc87f6b11da2ce2d56be11f66.png)

*   其中包含一些特殊的 IP 地址，如图所示。

![](https://i0.hdslb.com/bfs/album/20480e8d0981da1865a0f1986b80d9efebbf759f.png)

*   私有 IP 地址（网段个数就是网络号的个数）

![](https://i0.hdslb.com/bfs/album/9eb4582a6f6660bfa0e6738fe942fd9dd1ae621d.png)

### 4.6 网络地址转换 NAT

因为普通的路由器不能将局域网里的数据发送到因特网。所以需要 NAT 来实现它。

**网络地址转换 NAT**(Network Address Translation) : 在专用网连接到因特网的路由器上安装 NAT 软件，安装了 NAT 软件的路由器叫 NAT 路由器，它至少有一个有效的外部全球 IP 地址。

> 实现原理

*   里边含有一张 NAT 转换表，包含局域网里边的主机和因特网里边的一个 IP 地址。局域网里边的主机请求数据时 会进行 IP 地址转换，
    
    以此来获取数据。
    

![](https://i0.hdslb.com/bfs/album/ecb1c78f06ea12a43c5d2586b3d703344dcf4227.png)

### 4.7 子网划分与子网掩码

> 分类的 IP 地址的弱点

1.  IP 地址空间的利用率有时很低。
2.  两级 IP 地址不够灵活。

> 子网划分

![](https://i0.hdslb.com/bfs/album/0349ba92fae7c3cfa317734e95deb7b750cfbd9c.png)

> 子网掩码

子网掩码与 IP 地址逐位相与，就得到子网网络地址。

![](https://i0.hdslb.com/bfs/album/930a33e3e4dafea98c8fba236170274108d7e69b.png)

> 使用子网分组时的转发

![](https://i0.hdslb.com/bfs/album/ecbe26428531b1e51b27aeb7c2bd095f5745786b.png)

**解释**

1.  提取目的 IP 地址与路由表中的子网掩码进行与运算，如果找到，直接交付。没有找到，进行第三步。
2.  路由表中有一行是特定主机路由，查看目的 IP 的地址是否等于主机路由，等于交付。不等于进行第四步。
3.  目的 IP 地址与路由表中的每一个子网掩码进行与运算，有则交付。没有进入第五步。
4.  跳转到另一个路由，重复上述步骤。

### 4.8 无分类变址 CIDR

![](https://i0.hdslb.com/bfs/album/51ce0c156b9aff0b3155b546c2fa873f8ff793ab.png)

> 构成超网

![](https://i0.hdslb.com/bfs/album/3267fa8ea7cee146566592a94caa76cba75fd35f.png)

*   通过习题来练习一下

![](https://i0.hdslb.com/bfs/album/c24b38b319ce04357b95f667e2612cabc697a2bc.png)

前 24 位为网络前缀，后 8 位又进行了子网划分。通过子网掩码来确定子网掩码的位数。258 转换为二进制为 11111000。 子网位数为 5，最大子网个数为 2^5 =32, 分配地址个数 为 2^3 -2=6。 (减 2 是因为不能全为 0 或全为 1)。

### 4.9 ARP 协议

由于在实际网络的链路上传送数据帧时，最终必须使用 MAC 地址，如图所示。因此我们需要一种协议来获取 MAC 地址。

![](https://i0.hdslb.com/bfs/album/e67f59d4680af07bbdedc09cd8e1b0938d49b582.png)

**ARP 协议** : 完成主机或路由器 IP 地址到 MAC 地址的映射。

*   ARP 协议使用过程:

检查 ARP 高速缓存，有对应表项则写入 MAC 帧，没有则用目的 MAC 地址为 FF-FF-FF-FF-FF-FF 的帧封装并广播 ARP 请求分组，同一局域网中所有主机都能收到该请求。目的主机收到请求后就会向源主机单播一个 ARP 响应分组，源主机收到后将此映射写入 ARP 缓存 (10-20min 更新一次）。

*   ARP 协议 4 种典型情况:
    
    1.  主机 A 发给本网络上的主机 B: 用 ARP 找到主机 B 的硬件地址;
    2.  主机 A 发给另一网络上的主机 B: 用 ARP 找到本网络上一个路由器（网关）的硬件地址;
    3.  路由器发给本网络的主机 A: 用 ARP 找到主机 A 的硬件地址;
    4.  路由器发给另一网络的主机 B: 用 ARP 找到本网络上的一个路由器的硬件地址。
*   具体过程如图所示
    

![](https://i0.hdslb.com/bfs/album/32d4577a8c702010b9f579dd59803c4f4db85187.png)

### 4.10 DHCP 协议

主机可以静态和动态的获取 IP 地址。静态是管理员事先分配好主机的 IP 地址，子网掩码，默认网关等。动态则是依靠 DHCP 协议来完成的。接下来介绍一下 DHCP 协议。

动态主机配置协议（DHCP）是**应用层协议**，使用**客户 / 服务器**方式，客户端和服务端通过**广播方式**进行交互，基于 UDP。DHCP 提供即插即用联网的机制，主机可以从服务器动态获取 IP 地址、子网掩码、默认网关、DNS 服务器名称与 IP 地址, 允许**地址重用**，支持**移动用户加入网络**，支持**在用 地址续租**。

> 使用过程

![](https://i0.hdslb.com/bfs/album/a85cc184a6e01429d4042e770e21cb7fc7b3d1d5.png)

### 4.11 ICMP 协议

> 作用

![](https://i0.hdslb.com/bfs/album/147ab74559daa10fb74ddbc4b8846c357ecc5682.png)

从图中可以看出 ICMP 和传输层紧密相连。因此它的作用就是**为了更有效地转发 IP 数据报和提高交付成功的机会。**

> 构成

![](https://i0.hdslb.com/bfs/album/050a5d9382bd64d8d4bd6ae3c80b685ef7001db1.png)

*   从图中可以看出 ICMP 报文分为差错报文和询问报文。

> 差错报文

1.  终点不可达: 当路由器或主机不能交付数据报时就向源点发送终点不可达报文。（**无法交付**）
2.  时间超过: 当路由器收到生存时间 TTL=0 的数据报时，除丢弃该数据报外，还要向源点发送时间超过报文。当终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，并向源点发送时间超过报文。（**TTL=0**）
3.  参数问题: 当路由器或目的主机收到的数据报的首部中有的字段的值不正确时，就丢弃该数据报，并向源点发  
    送参数问题报文。（**首部字段有问题**）
4.  改变路由（重定向)︰路由器把改变路由报文发送给主机，让主机知道下次应将数据报发送给另外的路由器 (可通过更好的路由）。（**有更好的路由**）

> 差错报文构成

![](https://i0.hdslb.com/bfs/album/3dc2ae55d86948315ee963bd3f5a7ca5e480481e.png)

> 不发送 ICMP 报文的情况

1.  对 ICMP 差错报告报文不再发送 ICMP 差错报告报文。
2.  对第一个分片的数据报片的所有后续数据报片都不发送 ICMP 差错报告报文。
3.  对具有组播地址的数据报都不发送 ICMP 差错报告报文。
4.  对具有特殊地址（如 127.0.0.0 或 0.0.0.0）的数据报不发送 ICMP 差错报告报文。

> ICMP 询问报文

1.  回送请求和回答报文
    
    主机或路由器向特定目的主机发出的询问，收到此报文的主机必须给源主机或路由器发送 ICMP 回送回答报文。(**测试目的站是否可达以及了解其相关状态**)
    
2.  时间戳请求和回答报文
    
    请某个主机或路由器回答当前的日期和时间。(**用来进行时钟同步和测量时间**)
    

> ICMP 的应用

![](https://i0.hdslb.com/bfs/album/0730b7fd62318d94f4d7cfa995dca719277b6c21.png)

### 4.12 IPv6 数据报

*   IPv6 从根本上解决了 IPv4 地址不够用的问题。

添加的功能：

1.  快速处理 / 转发数据报
2.  支持 QoS（Qos (Quality of Service，服务质量）指一个网络能够利用各种基础技术，**为指定的网络通信提供更好的服务能力**, 是网络的一种安全机制，是用来解决网络延迟和阻塞等问题的一种技术。）

#### 1. 数据报格式

![](https://i0.hdslb.com/bfs/album/419807c9916999737db8fe147be47618285372b5.png)

*   详细的数据报格式

![](https://i0.hdslb.com/bfs/album/0005bc8e5b2be515cffaa0e064f2be8d3888beac.png)

#### 2. IPv4 和 IPv6 的区别

1.  IPv6 将地址从 32 位（4B）扩大到 128 位（16B），更大的地址空间。
2.  IPv6 将 IPv4 的校验和字段彻底移除，以减少每跳的处理时间。
3.  lPv6 将 IPv4 的可选字段移出首部，变成了扩展首部，成为灵活的首部格式，路由器通常不对扩展首部进行检查，大大提高了路由器的处理效率。
4.  IPv6 支持即插即用（即自动配置），不需要 DHCP 协议。
5.  IPv6 首部长度必须是 8B 的整数倍，IPv4 首部是 4B 的整数倍。
6.  IPv6 只能在主机处分片，IPv4 可以在路由器和主机处分片。
7.  ICMPv6: 附加报文类型 “分组过大”。
8.  IPv6 支持资源的预分配，支持实时视像等要求，保证一定的带宽和时延的应用。
9.  IPv6 取消了协议字段，改成下一个首部字段。
10.  IPv6 取消了总长度字段，改用有效载荷长度字段。
11.  IPv6 取消了服务类型字段。

#### 3.IPv6 的表示形式

![](https://i0.hdslb.com/bfs/album/ef6f04e0f5cc1efbf552463ab4d0db72af042203.png)

#### 4. IPv6 向 IPv4 过度策略

> 双栈协议

** 双协议栈技术就是指在一台设备上同时启用 lPv4 协议栈和 IPv6 协议栈。** 这样的话，这台设备既能和 IPv4 网络通信，又能和 IPv6 网络通信。如果这台设备是一个路由器，那么这台路由器的不同接口上，分别配置了 IPv4 地址和 IPv6 地址，并很可能分别连接了 IPv4 网络和 IPv6 网络。如果这台设备是一个计算机，那么它将同时拥有 IPv4 地址和 IPv6 地址，并具备同时处理这两个协议地址的功能。

> 隧道技术

通过使用互联网络的基础设施在网络之间传递数据的方式。使用隧道传递的数据（或负载) 可以是不同协议的数据帧或包。** 隧道协议将其它协议的数据帧或包重新封装然后通过隧道发送。** 意思就是将 IPv6 作为 IPv4 的数据部分，继续传输。到时候解封装。

![](https://i0.hdslb.com/bfs/album/6c16296e86e9e5886a16c2fb02ccd7c6142ba8d2.png)

### 4.13 路由算法与路由协议概述

#### 1. 作用

*   每一个路由里边都有一张路由表。表的结构如下图所示。由路由算法来填写表中内容，找出最佳路径。

![](https://i0.hdslb.com/bfs/album/6de37de6c04044d29778f7646eeb260f915abb5e.png)

#### 2. 分类

![](https://i0.hdslb.com/bfs/album/1e6ec43487e60385fc87bb5c8141609f878878d5.png)

![](https://i0.hdslb.com/bfs/album/c34290855a43ca734d15390f71c733441e6d0993.png)

#### 3. 分层次的路由选择协议

> 出现原因

(1）因特网规模很大  
(2）许多单位不想让外界知道自己的路由选择协议，但还想连入因特网

> 解决办法

**自治系统 AS**: 在单一的技术管理下的一组路由器，而这些路由器使用一种 AS 内部的路由选择协议和共同的度量以确定分组在该 AS 内的路由，同时还使用一种 AS 之间的路由协议以确定在 AS 之间的路由。

**一个 AS 内的所有网络都属于一个行政单位来管辖，一个自治系统的所有路由器在本自治系统内都必须连通。**

### 4.14 RIP 协议（距离向量算法）

RIP 是一种分布式的基于距离向量的路由选择协议，是因特网的协议标准，**最大优点是简单**。

RIP 协议要求网络中每一个路由器都维护从它自己到其他每一个目的网络的唯一最佳距离记录 (即一组距离）。距离: 通常为 “跳数”，即从源端口到目的端口所经过的路由器个数，经过一个路由器跳数 + 1。特别的，从一路由器到直接连接的网络距离为 1。RIP 允许一条路由最多只能包含 15 个路由器，因此距离为 16 表示网络不可达。

**RIP 的特点**: 当网络出现故障时，要经过比较长的时间 (例如数分钟) 才能将此信息传送到所有的路由器，“慢收敛”。

**RIP 协议只适用于小型互联网。**

![](https://i0.hdslb.com/bfs/album/197a25481513357870484f4d8f0627378893a8ad.png)

*   路由表如何更新？

![](https://i0.hdslb.com/bfs/album/af4bf9237c6508acd85c459c1a567ec11edea3fa.png)

*   通过例题来加深理解

![](https://i0.hdslb.com/bfs/album/514b69c5a0329681f0fb7d548170e8b62dd31e0a.png)

### 4.15 OSPF 协议（链路状态算法）

开放最短路径优先 OSPF 协议 :“开放” 标明 OSPF 协议不是受某一家厂商控制，而是公开发表的 ; “最短路径优先” 是因为使用了 Dijkstra 提出的最短路径算法 SPF。

OSPF 最主要的特征就是**使用分布式的链路状态协议**。

![](https://i0.hdslb.com/bfs/album/c0863aa1e66c1fc807d05378abda740aaa156824.png)

> 链路状态路由算法

1.  每个路由器发现它的邻居结点【HELLO 问候分组】，并了解邻居节点的网络地址。
    
2.  设置到它的每个邻居的成本度量 metric。
    
3.  构造【DD 数据库描述分组】，向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息。
    
4.  如果 DD 分组中的摘要自己都有，则邻站不做处理; 如果有没有的或者是更新的，则发送【LSR 链路状态请求分组】请求自己没有的和比自己更新的信息。
    
5.  收到邻站的 LSR 分组后，发送【LSu 链路状态更新分组】进行更新。
    
6.  更新完毕后，邻站返回一个【LSAck 链路状态确认分组】进行确认。
    
    只要一个路由器的链路状态发生变化:
    
    1.  泛洪发送【LSu 链路状态更新分组】进行更新。
    2.  更新完毕后，其他站返回一个【LSAck 链路状态确认分组】进行确认。
    3.  使用 Dijkstra 根据自己的链路状态数据库构造到其他节点间的最短路径。

> 其他特点

1.  OSPF 直接用 **IP 数据报**传送。
2.  每隔 30min，要刷新一次数据库中的链路状态。
3.  由于一个路由器的链路状态只涉及到与相邻路由器的连通状态，因而与整个互联网的规模并无直接关系。因此当互联网规模很大时，**OSPF 协议要比距离向量协议 RIP 好得多。**
4.  OSPF 不存在坏消息传的慢的问题，它的收敛速度很快。

### 4.16 BGP 协议

自治系统之间的使用的协议就是 BGP 协议。

![](https://i0.hdslb.com/bfs/album/fb3f20b3436a24fe3d5fa97c2d93e44f9f215d73.png)

*   和谁交换？

![](https://i0.hdslb.com/bfs/album/a1f1c024940fdb978abd0c63ce39f8add84fcee1.png)

> 交换信息的过程

BGP 所交换的网络可达性的信息就是要**到达某个网络所要经过的一系列 AS**。当 BGP 发言人互相交换了网络可达性的信息后，各 BGP 发言人就根据所采用的策略从收到的路由信息中找出到达各 AS 的较好路由。如图所示。

![](https://i0.hdslb.com/bfs/album/f6bd924cf408c6bc8315909b10f8de9a2df21911.png)

![](https://i0.hdslb.com/bfs/album/e2a6ebb13272ce4e7c12c30e2649131d6a5d4e55.png)

> 特点

*   BGP 支持 **CIDR**，因此 BGP 的路由表也就应当包括目的网络前缀、下一跳路由器，以及到达该目的网络所要经过的各个自治系统序列。
*   在 BGP 刚刚运行时，BGP 的邻站是交换整个的 BGP 路由表。但以后只需要**在发生变化时更新有变化的部分**。这样做对节省网络带宽和减少路由器的处理开销都有好处。

> BGP 报文类型

![](https://i0.hdslb.com/bfs/album/1b1709346a9aa2d300a179d2fd49235524ad25de.png)

### 4.17 三种协议比较

*   RIP 是一种分布式的基于**距离向量**的内部网关路由选择协议，通过广播 UDP 报文来交换路由信息。
*   OSPF 是一个内部网关协议，要交换的信息量较大，应使报文的长度尽量短，所以不使用传输层协议（如 UDP 或 TCP)，而是直接采用 IP。
*   BGP 是一个外部网关协议，在不同的自治系统之间交换路由信息，由于网络环境复杂，需要保证可靠传输所以采用 TCP。

![](https://i0.hdslb.com/bfs/album/a1c209a2799cc66f725bef8152165b32216ef60a.png)

### 4.18 IP 组播

#### 1. IP 数据报的三种传送方式

*   单播： 一对一
*   广播： 一对多（多指的所有）
*   组播： 一对多（多指的特定主机）

![](https://i0.hdslb.com/bfs/album/db100b987728aed5d8b1e3430a45c6082a5c5b56.png)

#### 2. IP 组播地址

![](https://i0.hdslb.com/bfs/album/f4e878d521bfa11e97f112d84587b54d7696f528.png)

#### 3. 硬件组播

![](https://i0.hdslb.com/bfs/album/da00c98987cda352a024353bf5ca00b795bd73d7.png)

#### 4. IGMP 协议和组播路由选择协议

*   IGMP 协议让路由器知道本局域网上是否有主机 (的进程) 参加或退出了某个组播组。

> IGMP 工作阶段

![](https://i0.hdslb.com/bfs/album/8e1efa4a9c6d557f2f8611d7fd324d7acf83523f.png)

*   组播路由选择协议目的是找出以源主机为根节点的组播转发树。
    
*   构造树可以避免在路由器之间兜圈子。
    
*   对不同的多播组对应于不同的多播转发树; 同一个多播组，对不同的源点也会有不同的多播转发树。
    

> 组播路由选择的算法

*   感兴趣的小伙伴可以去了解一下，这里不做过多讲解。

![](https://i0.hdslb.com/bfs/album/037d7769ca02f4ff5a6f259eb2007e6570102a2b.png)

### 4.19 移动 IP

#### 1. 移动 IP 的相关术语

移动 IP 技术是移动结点 (计算机 / 服务器等) 以固定的网络 IP 地址，实现跨越不同网段的漫游功能，并保证了基于网络 IP 的网络权限在漫游过程中不发生任何改变。

*   移动结点 具有永久 IP 地址的移动设备。
*   归属代理（本地代理) 一个移动结点拥有的就 “居所” 称为归属网络，在归属网络中代表移动节点执行移动管理功能的实体叫做归属代理。
*   外部代理（外地代理）在外部网络中帮助移动节点完成移动管理功能的实体称为外部代理。
*   永久地址（归属地址 / 主地址) 移动站点在归属网络中的原始地址。
*   转交地址（辅地址) 移动站点在外部网络使用的临时地址。

#### 2. 通信过程

*   A 进入外部网络

![](https://i0.hdslb.com/bfs/album/523c7bb8814c5bcf77b830f9cd140eb757706c6c.png)

*   A 进入下一个外部网络或者回到了归属网络

![](https://i0.hdslb.com/bfs/album/aeefa63bc7ba0021572740aee3d77ead603bc9ae.png)

### 4.20 网络层设备

网络层设备主要是路由器。

路由器是一种具有多个输入端口和多个输出端口的专用计算机，其任务是**转发分组**。

![](https://i0.hdslb.com/bfs/album/d404c68b662422e2cbe31deccd175f9039d92072.png)

> 输入端口对线路上收到的分组的处理

*   输入端口中的查找和转发功能在路由器的交换功能中是最重要的。

![](https://i0.hdslb.com/bfs/album/85e9341296b6708330c1bd7209635a7a08a3fed8.png)

> 输出端口将交换结构传送来的分组发送到线路

*   若路由器处理分组的速率赶不上分组进入队列的速率，则队列的存储空间最终必定减少到零，这就使后面再进入队列的分组由于没有存储空间而只能被丢弃。
*   路由器中的输入或输出队列产生溢出是造成分组丢失的重要原因。

![](https://i0.hdslb.com/bfs/album/f1fae217cd67a40d5d515229c3b0218942637ddb.png)

> 三层设备的区别

![](https://i0.hdslb.com/bfs/album/eab4695104f885ee591702701df0090ddb36871b.png)

> 路由表与路由转发

*   路由表根据路由选择算法得出的，主要用途是**路由选择**，总用软件来实现。结构如下图所示。

![](https://i0.hdslb.com/bfs/album/8c7986fff8d65356d5ffbacef8beb8c78a3a0c6c.png)

转发表由路由表得来，可以用软件实现，也可以用特殊的硬件来实现。**转发表必须包含完成转发功能所必需的信息**，在转发表的每一行必须包含从要到达的目的网络到输出端口和某些 MAC 地址信息的映射。

## 五、传输层
------

### 5.1 概述

*   传输层是**主机**才有的层次。
*   它使用网络层提供的服务为应用层提供服务。
*   功能：

1.  提供进程与进程之间的通信。
2.  复用和分用（后边会详细解释的）
3.  对收到的报文进行差错检测。

> 传输层最重要的两个协议——TCP 和 UDP。

![](https://i0.hdslb.com/bfs/album/6f7d62ee0a653b9b158e4486e9e1eb53a758e265.png)

> 寻址和端口

*   复用: 应用层所有的应用进程都可以通过传输层再传输到网络层。
*   分用: 传输层从网络层收到数据后交付指明的应用进程。
*   逻辑端口 / 软件端口 : 端口是传输层的 SAP，**标识主机中的应用进程**。
*   端口号只有本地意义，在因特网中不同计算机的相同端口是没有联系的。
*   端口号长度为 16bit，能表示 65536 个不同的端口号。

![](https://i0.hdslb.com/bfs/album/173df33c0f492421fbf53d0043dfba7f01da0687.png)

*   几个常用的端口号

![](https://i0.hdslb.com/bfs/album/e69869ce037bcaec3dcabdc2f43d75cfe123684d.png)

### 5.2 UDP 协议

*   UDP 在 IP 数据报服务之上添加了复用分用和差错检测的功能。

> 主要特点

1.  UDP 是**无连接**的，减少开销和发送数据之前的时延
2.  UDP 使用最大努力交付，即**不保证可靠交付**。
3.  UDP 是**面向报文**的，适合一次性传输少量数据的网络应用。
4.  UDP 无拥塞控制，适合很多实时应用。
5.  UDP 首部开销小，8B，TCP 20B。

![](https://i0.hdslb.com/bfs/album/97969ddecfec2de60b33de98c219062ccb41a494.png)

> UDP 的首部格式

![](https://i0.hdslb.com/bfs/album/4aed15902518fa4422299e812ba202c3304150b6.png)

> UDP 校验

*   这部分我暂时也咩看懂，所以不做太多解释。

![](https://i0.hdslb.com/bfs/album/20cf199af60e14b564a0a5a59b8f61682249d230.png)

![](https://i0.hdslb.com/bfs/album/d0387c731ff612c08566cb39f610aad6016f3336.png)

### 5.3 TCP 协议

#### 1.TCP 协议的特点

![](https://i0.hdslb.com/bfs/album/e45cb2db0fe3f557dc4c0452b7fedf5dcefbd253.png)

*   字节流发送如图所示

![](https://i0.hdslb.com/bfs/album/5fe49bd121b0c17609608961ef7ff3ce6f09d7ba.png)

#### 2. TCP 报文段首部格式

![](https://i0.hdslb.com/bfs/album/f798bcd4e6574fdc98da178f33cfc120e6c1cf80.png)

![](https://i0.hdslb.com/bfs/album/14e71b2da875ae807f07eb27cb3e36f98ba30516.png)

![](https://i0.hdslb.com/bfs/album/b765a3a06e867fd8bf00fd208ffe7921ec391cc0.png)

### 5.4 TCP 连接管理

![](https://i0.hdslb.com/bfs/album/f46c58904ef0a6b2086fa65291fc2fa1d1619ddd.png)

#### 1. 建立连接

![](https://i0.hdslb.com/bfs/album/ed70b2fd796dd00e6919449955cdcdac973ce136.png)

假设运行在一台主机（客户) 上的一个进程想与另一台主机（服务器) 上的一个进程建立一条连接，客户应用进程首先通知客户 TCP，他想建立一个与服务器上某个进程之间的连接，客户中的 TCP 会用以下步骤与服务器中的 TCP 建立一条 TCP 连接:

*   SYN 连接请求报文
*   seq 序号
*   ACK 确认连接
*   ack 确认号

![](https://i0.hdslb.com/bfs/album/3bff643d5ff20ea409df7e0a3b1c80fc5048c6eb.png)

#### 2. 释放连接

![](https://i0.hdslb.com/bfs/album/97878e2cce25935dd53f4e4a2c858fcdce66f9e7.png)

参与一条 TCP 连接的两个进程中的任何一个都能终止该连接，连接结束后，主机中的 “资源”(缓存和变量）将被释放。  
![](https://i0.hdslb.com/bfs/album/0c16bbea3597646cf783d5210ce2bc473f40feb4.png)

### 5.5 TCP 可靠传输

![](https://i0.hdslb.com/bfs/album/fc58c6d144db1b2f0b66c8bd95134a74adac3157.png)

可靠传输： 保证接收方进程从缓存区读出的字节流与发送方发出的字节流是完全一样的。

> TCP 协议实现可靠传输的机制

1.  校验（与 UDP 校验一样，增加伪首部）
2.  序号
3.  确认
4.  重传

### 5.6 TCP 流量控制

*   流量控制: 让发送方慢点，要让接收方来得及接收。
*   TCP 利用**滑动窗口机制**实现流量控制。

在通信过程中，接收方根据自己接收缓存的大小，动态地调整发送方的发送窗口大小，即接收窗口 rwnd(接收方设置确认报文段的窗口字段来将 rwnd 通知给发送方），发送方的发送窗口取接收窗口 rwnd 和拥塞窗口 cwnd 的最小值。

![](https://i0.hdslb.com/bfs/album/f8dd5654835ae7e0c549372e0631665f9919a9c9.png)

### 5.7 TCP 拥塞控制

*   出现拥塞的条件  
    对资源需求的总和 > 可用资源
*   网络中有许多资源同时呈现供应不足→网络性能变坏→网络吞吐量将随输入负荷增大而下降
*   拥塞控制  
    防止过多的数据注入到网络中。**全局性**

> 拥塞控制和流量控制的区别

拥塞控制是全局性的。

流量控制是点对点的。

![](https://i0.hdslb.com/bfs/album/2d9d7115609740562e4b5dcf0e4d51c29c1f22cc.png)

*   在介绍拥塞控制算法之前，先设定几个前提条件，便于理解。

![](https://i0.hdslb.com/bfs/album/52e95d712e6c1da68bf1850fe0002893ee035394.png)

#### 1. 慢开始和拥塞避免

*   刚开始进行指数增长，到达 ssthresh 之后，进行加法增长。
*   遇到网络拥塞之后，降到初始值，重复之前的步骤。新的 ssthresh 设为 拥塞时窗口大小的一半。

![](https://i0.hdslb.com/bfs/album/3b541a37c3a1ff0d47af091a06600baa8d449299.png)

#### 2. 快重传和快回复

*   前面的步骤和之前一样。不同的是降低拥塞窗口的时机和大小不同。如图所示，当收到 3 个重复的确认时，执行快重传算法，拥塞窗口降到原来的一般。

![](https://i0.hdslb.com/bfs/album/c8f9adbd2ddbcc85f236255151102c58aaee8356.png)

## 六、应用层
------

### 6.1 概述

*   应用层对应用程序的通信提供服务。
    
*   应用层协议定义:
    
    1.  应用进程交换的报文类型，请求还是响应?
    2.  各种报文类型的语法，如报文中的各个字段及其详细描述。
    3.  字段的语义，即包含在字段中的信息的含义。
    4.  进程何时、如何发送报文，以及对报文进行响应的规则。

<table><thead><tr><th>应用层的功能</th><th>对应的协议</th></tr></thead><tbody><tr><td>文件传输，访问和管理</td><td>FTP</td></tr><tr><td>电子邮件</td><td>SMTP，POP3</td></tr><tr><td>虚拟终端</td><td>HTTP</td></tr><tr><td>查询服务和远程作业登录</td><td></td></tr></tbody></table>

### 6.2 网络应用模型

#### 1. 客户 / 服务器（C/S）模型

![](https://i0.hdslb.com/bfs/album/88db7d45f75c59ebcd62ecf8b148e7542b172f31.png)

#### 2. P2P 模型

![](https://i0.hdslb.com/bfs/album/1237601f8c542360befdec8bc1bce8a3c95ff59a.png)

### 6.3 DNS 系统

DNS 服务的作用 : 将域名解析成 IP 地址。

#### 1. 域名

*   com 有一个点，就是 根

![](https://i0.hdslb.com/bfs/album/4a80cffa1cac5b67674f79c4bfe80d64a9ad813b.png)

#### 2.DNS 服务器

![](https://i0.hdslb.com/bfs/album/fb2b77ff7948b227139b708fb178421598e55dfb.png)

#### 3. 域名解析过程

域名解析主要有两种方法： ①递归（考别人）②迭代（靠自己）

![](https://i0.hdslb.com/bfs/album/ec98d7e7ab736830fc1942ebb5fc67ca84b0ea6c.png)

### 6.4 文件传输协议 FTP

*   文件传送协议 FTP (File Transfer Protocol) 提供不同种类主机系统（硬、软件体系等都可以不同) 之间的文件传输能力。
*   FTP 是基于客户 / 服务器 (C/S）的协议。
*   用户通过一个客户机程序连接至在远程计算机上运行的服务器程序。
*   依照 FTP 协议提供服务，进行文件传送的计算机就是 FTP 服务器。
*   连接 FTP 服务器，遵循 FTP 协议与服务器传送文件的电脑就是 FTP 客户端。
*   FTP 传输模式
    1.  文本模式: ASCIl 模式，以文本序列传输数据;
    2.  二进制模式: Binary 模式，以二进制序列传输数据。

> 工作原理

![](https://i0.hdslb.com/bfs/album/90740d3f46b55d9ce41bad815023a2144dac38c6.png)

![](https://i0.hdslb.com/bfs/album/30e92615d0cf0941b0224072e9f94c74799dc5fe.png)

### 6.5 电子邮件

#### 1. 信息格式

![](https://i0.hdslb.com/bfs/album/6ac39be7f92771e49af7c63a3557957a773c9f39.png)

#### 2. 组成结构

![](https://i0.hdslb.com/bfs/album/842a57dfc64bfeb38d92dd9285368a29ab5bba1a.png)

#### 3.SMAP 协议

*   SMTP 规定了在两个相互通信的 SMTP 进程之间应如何交换信息。
*   负责发送邮件的 SMTP 进程就是 SMTP 客户，负责接收邮件的进程就是 SMTP 服务器。
*   SMTP 规定了 14 条命令 (几个字母）和 21 种应答信息（三位数字代码 + 简单文字说明）。

> SMAP 通信的三个阶段

![](https://i0.hdslb.com/bfs/album/4b07de9ff8ee61a834acd215561880d6c4f1caf1.png)

#### 4. MIME

![](https://i0.hdslb.com/bfs/album/3b88a53e31b76e96393ee48a10afaed4205bfbb3.png)

#### 5. 邮局协议 POP3

![](https://i0.hdslb.com/bfs/album/561e36068e7fad066675acd06193628974bc5415.png)

#### 6. 国际报文存取协议 IMAP

*   IMAP 协议比 POP 协议复杂。当用户 PC 上的 IMAP 客户程序打开 IMAP 服务器的邮箱时，用户可以看到邮箱的首部，若用户需要打开某个邮件，该邮件才上传到用户的计算机上。
*   IMAP 可以让用户在不同的地方使用不同的计算机随时上网阅读处理邮件，还允许只读取邮件中的某一个部分 (先看正文，有 WiFi 的时候再下载附件）。

#### 7. 基于万维网的电子协议

![](https://i0.hdslb.com/bfs/album/39611db85ca0ecbe4a2de75eb3cdc2db2ad46693.png)

### 6.6 万维网和 HTTP 协议

#### 1. 万维网概述

万维网 www (World Wide web）是一个大规模的、联机式的信息储藏所 / 资料空间，是无数个网络站点和网页的集合。

我们需要一个统一标识符（URL）来区分万维网上的各种资源。

![](https://i0.hdslb.com/bfs/album/00780ee036127b933b9a2ab0245bf890fba4c1fe.png)

用户通过点击超链接 (http:/www.baidu.com) 获取资源，这些资源通过超文本传输协议 HTTP 传送给使用者。

万维网以**客户 / 服务器**方式工作，用户使用的浏览器就是万维网客户程序，万维网文档所驻留的主机运行服务器程序。

万维网使用超文本标记语言 HTML，使得万维网页面设计者可以很方便地从一个界面的链接转到另一个界面，并能够在自己的屏幕上显示出来。

#### 2.HTTP

HTTP 协议定义了浏览器（万维网客户进程〉怎样向万维网服务器请求万维网文档，以及服务器怎样把文档传送给浏览器。

![](https://i0.hdslb.com/bfs/album/3ee644ae9bec0f32195912b3514140f98ff466bb.png)

> HTTP 协议的特点

![](https://i0.hdslb.com/bfs/album/4c4e9a95905f27081d510869d8f1f23f74f4ee2d.png)

> 报文结构

![](https://i0.hdslb.com/bfs/album/14c122549f6cbca06e8e5160a77893f1b65368db.png)

![](https://i0.hdslb.com/bfs/album/936b944a17ba25a9f2658de904b30f4d67434f50.png)
